@{
    ViewBag.Title = "Bandeja de Gestión Usuarios";
    Layout = "~/Views/Shared/_LayoutAdm.cshtml";
}
<div class="breadcrumbs" id="breadcrumbs" style="top:0px; padding: 0 0 0 0">
    <script type="text/javascript">
        try { ace.settings.check('breadcrumbs', 'fixed') } catch (e) { }
    </script>

    <ul class="breadcrumb">
        <li>
            <i class="ace-icon fa fa-home home-icon"></i>&nbsp;<a href="~/Home/Index">Inicio</a>
        </li>
        <li>
            <i class="ace-icon fa fa-key"></i>&nbsp;<a href="~/Home/Index">Acceso a usuarios</a>
        </li>
        <li>
            <i class="ace-icon fa fa-users"></i>&nbsp;<a href="frmGestionUsuarios">Gestión Usuarios</a>
        </li>
        @*<li class="active">Profile 1</li>*@
    </ul>
</div>
<body data-ng-controller="frmGestionUsuariosController">
    @*<div style="height:100%;">*@
    <div class="ace-settings-container" id="ace-settings-container">

        <div class="btn btn-app btn-xs btn-warning ace-settings-btn" id="ace-settings-btn">
            <i class=" glyphicon glyphicon-search"></i>
        </div>

        <div class="ace-settings-box clearfix" id="ace-settings-box">

            <div class="container container-fluid" style="padding:0 0 0 0;width:280px;">

                <div class="row">
                    <div class="col-md-4" style="width:15px;">
                        &nbsp;
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12 col-xs-12 col-lg-12" style="text-align: right;">
                        <button type="button" id="btnConsultaUs" class="btn btn-sm btn-round"
                                style="background-color:rgb(238,37,34)!important;border-color:rgb(238,37,34)!important;"
                                create-pages results="resDgUsrsAdmin" number-per-page="15" pages="pagesUsrsAdmin"
                                page-content="pgcDgUsrsAdmin;" page-limit="67" binding="blur"
                                ng-click="btnConsultaClick(); showPaginate=true;">
                            <i class="glyphicon glyphicon-search"></i>
                            Consultar
                        </button>
                    </div>
                </div>

                <div class="row" style="width:15px;">
                    <div class="col-md-4">
                        &nbsp;
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12 col-xs-12 col-lg-12 titulos">
                        <span class="lbl">Criterios de Búsqueda</span>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12 col-xs-12 col-lg-12">
                        <br />
                        <label>
                            <input type="radio" name="FiltrosCons" class="ace" id="rbtPorRuc" ng-model="rbtOpciones" value="R" />
                            <span class="lbl">Por RUC</span>
                        </label>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12 col-xs-12 col-lg-12">
                        <input type="text" name="Ruc" id="txtFiltraRuc" class="form-control" ng-model="txtFiltraRuc" maxlength="13" only-digits placeholder="RUC" style="margin-left: 30px; width: 70%" />
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12 col-xs-12 col-lg-12">
                        <br />
                        <label>
                            <input type="radio" name="FiltrosCons" class="ace" id="rbtPorNombre" ng-model="rbtOpciones" value="N" />
                            <span class="lbl">Por Nombre</span>
                        </label>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12 col-xs-12 col-lg-12">
                        <input type="text" name="Nombre" id="txtFiltraNombre" class="form-control" ng-model="txtFiltraNombre" maxlength="35" placeholder="Nombre" style="margin-left: 30px; width: 70%" />
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12 col-xs-12 col-lg-12">
                        &nbsp;
                    </div>
                </div>

            </div>

        </div>

    </div>

    <div cg-busy="{promise:myPromise,message:message,backdrop:true}">

        <div class='form-group'>

            <div class="widget-box">
                <div class="widget-header" style="text-align:center;text-wrap:none;">
                    <h4 class="widget-title">BANDEJA DE USUARIOS</h4>
                    <div class="widget-toolbar">
                        <a href="#" data-action="collapse">
                            <i class="ace-icon fa fa-chevron-up"></i>
                        </a>
                    </div>
                    <font ng-hide="etiTotRegistros==''" class="widget-toolbar"> Total: {{etiTotRegistros}} Registros </font>
                </div>
                <div class="widget-body">
                    <div class="widget-main">
                        <div ng-controller="PaginationController">
                            <div ng-show="showPaginate">
                                <div id="no-more-tables">
                                    <table class="table table-striped table-bordered table-condensed table-hover gridStyle">
                                        <thead>
                                            <tr>
                                                <th class="grid-header uppercase info" >
                                                    <a href="#" ng-click="sortType = 'pRuc'; sortReverse = !sortReverse">
                                                        RUC
                                                        <span ng-show="sortType == 'pRuc' && !sortReverse" class="fa fa-caret-down"></span>
                                                        <span ng-show="sortType == 'pRuc' && sortReverse" class="fa fa-caret-up"></span>
                                                    </a>
                                                </th>
                                                <th class="grid-header uppercase info" >
                                                    <a href="#" ng-click="sortType = 'pUsuario'; sortReverse = !sortReverse">
                                                        Usuario
                                                        <span ng-show="sortType == 'pUsuario' && !sortReverse" class="fa fa-caret-down"></span>
                                                        <span ng-show="sortType == 'pUsuario' && sortReverse" class="fa fa-caret-up"></span>
                                                    </a>
                                                </th>
                                                <th class="grid-header uppercase info" >
                                                    <a href="#" ng-click="sortType = 'pNombres'; sortReverse = !sortReverse">
                                                        Nombres
                                                        <span ng-show="sortType == 'pNombres' && !sortReverse" class="fa fa-caret-down"></span>
                                                        <span ng-show="sortType == 'pNombres' && sortReverse" class="fa fa-caret-up"></span>
                                                    </a>
                                                </th>
                                                <th class="grid-header uppercase info" >
                                                    <a href="#" ng-click="sortType = 'pApellidos'; sortReverse = !sortReverse">
                                                        Apellidos
                                                        <span ng-show="sortType == 'pApellidos' && !sortReverse" class="fa fa-caret-down"></span>
                                                        <span ng-show="sortType == 'pApellidos' && sortReverse" class="fa fa-caret-up"></span>
                                                    </a>
                                                </th>
                                                <th class="grid-header uppercase info" >
                                                    <a href="#" ng-click="sortType = 'correoE'; sortReverse = !sortReverse">
                                                        Correo
                                                        <span ng-show="sortType == 'correoE' && !sortReverse" class="fa fa-caret-down"></span>
                                                        <span ng-show="sortType == 'correoE' && sortReverse" class="fa fa-caret-up"></span>
                                                    </a>
                                                </th>
                                                <th class="grid-header uppercase info" >
                                                    <a href="#" ng-click="sortType = 'celular'; sortReverse = !sortReverse">
                                                        Celular
                                                        <span ng-show="sortType == 'celular' && !sortReverse" class="fa fa-caret-down"></span>
                                                        <span ng-show="sortType == 'celular' && sortReverse" class="fa fa-caret-up"></span>
                                                    </a>
                                                </th>
                                                <th class="grid-header uppercase info" >
                                                    <a href="#" ng-click="sortType = 'rol'; sortReverse = !sortReverse">
                                                        Rol Administrador
                                                        <span ng-show="sortType == 'rol' && !sortReverse" class="fa fa-caret-down"></span>
                                                        <span ng-show="sortType == 'rol' && sortReverse" class="fa fa-caret-up"></span>
                                                    </a>

                                                </th>
                                                <th class="grid-header uppercase info" >
                                                    <a href="#" ng-click="sortType = 'rol'; sortReverse = !sortReverse">
                                                        Rol Contable
                                                        <span ng-show="sortType == 'rol' && !sortReverse" class="fa fa-caret-down"></span>
                                                        <span ng-show="sortType == 'rol' && sortReverse" class="fa fa-caret-up"></span>
                                                    </a>

                                                </th>
                                                <th class="grid-header uppercase info" >
                                                    <a href="#" ng-click="sortType = 'rol'; sortReverse = !sortReverse">
                                                        Rol Logístico
                                                        <span ng-show="sortType == 'rol' && !sortReverse" class="fa fa-caret-down"></span>
                                                        <span ng-show="sortType == 'rol' && sortReverse" class="fa fa-caret-up"></span>
                                                    </a>

                                                </th>
                                                <th class="grid-header uppercase info" >
                                                    <a href="#" ng-click="sortType = 'rol'; sortReverse = !sortReverse">
                                                        Rol Comercial
                                                        <span ng-show="sortType == 'rol' && !sortReverse" class="fa fa-caret-down"></span>
                                                        <span ng-show="sortType == 'rol' && sortReverse" class="fa fa-caret-up"></span>
                                                    </a>

                                                </th>



                                                @*<th class="grid-header uppercase info" style="text-align:center;">
                                                    <a href="#" ng-click="sortType = 'pCodLegacy'; sortReverse = !sortReverse">
                                                        CÓDIGO LEGACY
                                                        <span ng-show="sortType == 'pCodLegacy' && !sortReverse" class="fa fa-caret-down"></span>
                                                        <span ng-show="sortType == 'pCodLegacy' && sortReverse" class="fa fa-caret-up"></span>
                                                    </a>
                                                </th>
                                                <th class="grid-header uppercase info" style="text-align:center;">
                                                    <a href="#" ng-click="sortType = 'pUserLegacy'; sortReverse = !sortReverse">
                                                        USUARIO LEGACY
                                                        <span ng-show="sortType == 'pUserLegacy' && !sortReverse" class="fa fa-caret-down"></span>
                                                        <span ng-show="sortType == 'pUserLegacy' && sortReverse" class="fa fa-caret-up"></span>
                                                    </a>
                                                </th>*@
                                                <th class="grid-header uppercase info" >
                                                    <a >
                                                        Editar
                                                       
                                                    </a>
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr ng-repeat="row in pgcDgUsrsAdmin | orderBy:sortType:sortReverse">
                                                <td class="filacentro" data-title="RUC">{{row.pRuc}}</td>
                                                <td class="filaizquierda"  data-title="USUARIO">{{row.pUsuario}}</td>
                                                <td class="filaizquierda"  data-title="NOMBRES">{{row.pNombres}}</td>
                                                <td class="filaizquierda"  data-title="APELLIDOS">{{row.pApellidos}}</td>
                                                <td class="filaizquierda"  data-title="CORREO">{{row.pCorreo}}</td>
                                                <td class="filacentro" data-title="CELULAR">{{row.pCelular}}</td>                                             
                                                <td class="filacentro"  data-title="ROL ADMINISTRADOR">
                                                    <a class="red" href="#" ng-show="row.prolAdmin">
                                                        <i class="ace-icon glyphicon glyphicon-ok bigger-130"></i>
                                                    </a>
                                                </td>
                                                <td class="filacentro" style="font-size:11px; text-align:center;" data-title="ROL CONTABLE">
                                                    <a class="red" href="#" ng-show="row.prolContable">
                                                        <i class="ace-icon glyphicon glyphicon-ok bigger-130"></i>
                                                    </a>
                                                </td>
                                                <td class="filacentro" style="font-size:11px; text-align:center;" data-title="ROL LOGISTICO">
                                                    <a class="red" href="#" ng-show="row.prolLogistico">
                                                        <i class="ace-icon glyphicon glyphicon-ok bigger-130"></i>
                                                    </a>
                                                </td>
                                                <td class="filacentro" style="font-size:11px; text-align:center;" data-title="ROL COMERCIAL">
                                                    <a class="red" href="#" ng-show="row.prolComercial">
                                                        <i class="ace-icon glyphicon glyphicon-ok bigger-130"></i>
                                                    </a>

                                                </td>

                                                @*<td style="font-size:smaller;" data-title="CÓDIGO LEGACY">{{row.pCodLegacy}}</td>
                                                <td style="font-size:smaller;" data-title="USUARIO LEGACY">{{row.pUserLegacy}}</td>*@
                                                <td class="filacentro" style="font-size:smaller;text-align:center;">
                                                    <a class="btn btn-danger btn-xs" ng-click="GestionUsuario(row);" style="border-width: 1px;padding: 0 5px;">
                                                        <i class="fa fa-pencil"></i>
                                                    </a>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                
                                <ul style="position: relative;" class="pagination" ng-hide="pagesUsrsAdmin.length==0">

                                    <li pagination ng-class="[{active: page == getCurrentPage()}, {disabled: isFirstPage()} ]  " page="1">
                                        <a><div class="glyphicon glyphicon-fast-backward"></div></a>
                                    </li>
                                    <li ng-class="{disabled: isFirstPage()}" pagination-left><a><div class="glyphicon glyphicon-backward"></div></a></li>
                                    <li>
                                        <a> {{getCurrentPage()}} </a> <a>de</a> <a> {{pagesUsrsAdmin.length}}</a>
                                    </li>
                                    <li ng-class="{disabled: isLastPage()}" pagination-right><a><div class="glyphicon glyphicon-forward"></div></a></li>
                                    <li pagination ng-class="[{active: page == getCurrentPage()}, {disabled: isLastPage()} ]  " page="{{pagesUsrsAdmin.length}}">
                                        <a><div class="glyphicon glyphicon-fast-forward"></div></a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        @Html.Partial("_mensajeError")
        @Html.Partial("_mensajeInformativo")
        @Html.Partial("_mensajeOK")
        @Html.Partial("_mensajeConfirmacion")

        @*Session modal nuevo ingreso usuario/cod legacy*@
        <form name="Usuarioform" id="Usuarioform" ng-submit="adicionausuario()">
            <div class=" main-container" id="main-container">
                <div id="modal-form" class="modal fade" data-backdrop="static" style="height: 100%; width: 100%; z-index: 90;" data-keyboard="false" role="dialog" aria-hidden="true" tabindex="-1">
                    <div class="modal-dialog" style="padding-top: 10%; height:80%; width:60%;">
                        <div class="modal-content">
                            <div class="modal-header ">
                                <div class="widget-box">
                                    <div class="widget-header">
                                        <button type="button" class="close" data-dismiss="modal" ng-click="limpiadatos()">&times;</button>
                                        <h4 class="bigger">
                                            Registro / Edición
                                        </h4>
                                    </div>

                                </div>
                            </div>
                            <div class="modal-body">
                                <div class="row">
                                    <div class="col-md-12 col-md-12">
                                        <div class="form-group">
                                            <label class="col-md-2 control-label no-padding-right" for="form-field-1"> RUC:</label>
                                            <div class="col-md-3">
                                                <input ng-disabled="true" name="ruc" type="text" id="form-field-1" placeholder="(Solo lectura)" class="col-md-12 col-md-12"
                                                       maxlength="13" class="form-control" data-ng-model="p_User.pRuc" />

                                            </div>
                                            <label class="col-md-1 control-label no-padding-right" for="form-field-1"></label>
                                            <label class="col-md-2 control-label no-padding-right" for="form-field-username">Usuario:</label>
                                            <div class="col-md-3">
                                                <input ng-disabled="true" name="userportal" type="text" id="form-field-1" placeholder="(Solo lectura)" class="col-md-12 col-md-12"
                                                       maxlength="13" class="form-control" data-ng-model="p_User.pUsuario" />

                                            </div>
                                        </div>
                                        <div class="space-4"></div>
                                        <div class="form-group">
                                            <div class="col-md-12">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-md-2 control-label no-padding-right" for="form-field-1	">Nombres:</label>
                                            <div class="col-md-9">
                                                <input ng-disabled="true" name="nombres" type="text" id="form-field-1" placeholder="(Solo lectura)" class="col-md-12 col-md-12"
                                                       maxlength="13" class="form-control" data-ng-model="p_User.pNombres" />

                                            </div>
                                        </div>
                                        <div class="space-4"></div>
                                        <div class="form-group">
                                            <div class="col-md-12">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-md-2 control-label no-padding-right" for="form-field-1">Cód Sist. Legacy:*</label>
                                            <div class="col-md-3">
                                                <input ng-disabled="false" name="codsislegacy" class=" form-control col-md-12 col-md-12 clsToUpper" type="text" id="form-field-1" placeholder="Código del Sistema Legacy" value=""
                                                       ng-required="true" oninvalid="setCustomValidity('El Código del Sistema Legacy es Requerido')" oninput="    setCustomValidity('')"
                                                       maxlength="35" data-ng-model="p_User.pCodLegacy"
                                                       minlength="3" data-ng-class='{ error: Usuarioform.codsislegacy.$invalid && !codsislegacy.$pristine }' />
                                            </div>
                                            <label class="col-md-1 control-label no-padding-right" for="form-field-1"></label>
                                            <label class="col-md-2 control-label no-padding-right" for="form-field-1">Usr. Sist. Legacy:*</label>
                                            <div class="col-md-3">
                                                <input ng-disabled="false" name="ususislegacy" class="col-md-12 col-md-12 clsToUpper" type="text" id="form-field-1" placeholder="Usuario Sistema Legacy" value=""
                                                       ng-required="true" oninvalid="setCustomValidity('El Usuario del Sistema Legacy')" oninput="    setCustomValidity('')"
                                                       maxlength="35" data-ng-model="p_User.pUserLegacy"
                                                       minlength="3" data-ng-class='{ error: Usuarioform.ususislegacy.$invalid && !ususislegacy.$pristine }' />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer ">
                            <button class="btn btn-sm btn-round" style="background-color:rgb(238,37,34)!important;border-color:rgb(238,37,34) !important" data-dismiss="modal" ng-click="limpiadatos()">
                                <i class="ace-icon fa fa-close"></i>
                                Cancelar
                            </button>
                            <button type="submit" class="btn btn-sm btn-round" style="background-color:rgb(238,37,34)!important;border-color:rgb(238,37,34) !important" 
                                    id="btnConsulta" >
                                <i class="ace-icon glyphicon glyphicon-floppy-disk"></i>
                                Grabar
                            </button>
                        </div>
                    </div>

                </div>
            </div>

        </form>
        @*Session fin modal nuevo ingreso usuario/cod legacy*@


    </div>
</body>
@section scripts{
    <script type="text/javascript">
        $(document).ready(function () {
            //$("#btnConsulta").click(function () {
            //    $("#divGrdUsrsAdmin").css("visibility", "visible");
            //});
            $("#btnCerrar").click(function () {
                setTimeout(function () { $('#btnConsulta').focus(); }, 100);
                setTimeout(function () { $('#rbtPorUsuario').focus(); }, 150);
            });

            $('#txtFiltraCodSap').keypress(function (e) {
                var regex = new RegExp("^[A-Z0-9]");
                var str = String.fromCharCode(!e.charCode ? e.which : e.charCode);
                if (regex.test(str)) {
                    return true;
                }
                e.preventDefault();
                return false;
            });

        });
    </script>}

