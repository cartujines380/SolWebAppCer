@{
    ViewBag.Title = "Facturas No Electrónicas";
    Layout = "~/Views/Shared/_LayoutPrivado.cshtml";
}
@section styles{
    <link href="~/Content/Validation.css" rel="stylesheet" />
    <link href="~/assets/css/fileinput.css" rel="stylesheet" />
    <link href="~/assets/css/angular-busy.css" rel="stylesheet" />
}
@using WebAppMVC.Helper
<div class="breadcrumbs" id="breadcrumbs" style="top:0px;">
    <script type="text/javascript">
        try { ace.settings.check('breadcrumbs', 'fixed') } catch (e) { }
    </script>

    <ul class="breadcrumb">
        <li>
            <i class="ace-icon fa fa-home home-icon"></i>&nbsp;<a href="~/Home/IndexPrivado">Inicio</a>
        </li>
        <li>
            <i class="ace-icon fa fa-money"></i>&nbsp;<a href="~/Home/IndexPrivado">Factura Manual</a>
        </li>
        <li>
            <i class="ace-icon glyphicon glyphicon-list-alt"></i>&nbsp;<a href="frmControlFacturas">Facturas No Electrónicas</a>
        </li>
        @*<li class="active">Profile 1</li>*@
    </ul><!-- /.breadcrumb -->
    <!-- #section:basics/content.searchbox -->
    <!-- /section:basics/content.searchbox -->
</div>
<body data-ng-controller="frmControlFacturasController" @Html.RequestVerificationToken()>

    <div cg-busy="{promise:myPromise,message:message,backdrop:true}">

        <form name="frmControlFacturas" ng-submit="btnSubmitClick()">

            <div class="widget-body">

                <div class="widget-main">

                    <div class="row">
                        <div class="col-md-7">
                            <br />
                            <div class="row">
                                <div class="col-md-12">
                                    <button type="submit" id="btnGrabar" ng-click="btnGrabarClick()" ng-hide="hide_btnGrabar" class="btn btn-sm btn-purple" style="font-size:10pt;background-color:rgb(238,37,34)!important;border-color:rgb(238,37,34)!important;">
                                        <i class="ace-icon glyphicon glyphicon-floppy-disk"></i>
                                        Grabar
                                    </button>
                                    <button type="submit" id="btnEnviar" ng-click="btnEnviarClick()" ng-hide="hide_btnEnviar" class="btn btn-sm btn-purple" style="font-size:10pt;background-color:rgb(238,37,34)!important;border-color:rgb(238,37,34)!important;">
                                        <i class="ace-icon fa fa-send"></i>
                                        Enviar
                                    </button>
                                    <button type="button" id="btnAnular" ng-click="btnAnularClick()" ng-hide="hide_btnAnular" class="btn btn-sm btn-purple" style="font-size:10pt;background-color:rgb(238,37,34)!important;border-color:rgb(238,37,34)!important;">
                                        <i class="ace-icon fa fa-close"></i>
                                        Anular
                                    </button>
                                    <button type="button" id="btnModificar" ng-click="btnModificarClick()" ng-hide="hide_btnModificar" class="btn btn-sm btn-purple" style="font-size:10pt;background-color:rgb(238,37,34)!important;border-color:rgb(238,37,34)!important;">
                                        <i class="ace-icon fa fa-pencil"></i>
                                        Modificar/Anular
                                    </button>
                                    <button type="button" id="btnGetXML" ng-click="btnGetXMLClick()" ng-hide="hide_btnGetXML" class="btn btn-sm btn-purple" style="font-size:10pt;background-color:rgb(238,37,34)!important;border-color:rgb(238,37,34)!important;">
                                        <i class="ace-icon fa fa-download"></i>
                                        Descargar XML
                                    </button>
                                    <button type="button" id="btnGetPDF" ng-click="btnGetPDFClick()" ng-hide="hide_btnGetPDF" class="btn btn-sm btn-purple" style="font-size:10pt;background-color:rgb(238,37,34)!important;border-color:rgb(238,37,34)!important;" tooltip="DESCARGAR LA REPRESENTACIÓN IMPRESA NO ELECTRÓNICA">
                                        <i class="ace-icon fa fa-download"></i>
                                        Descargar RINE
                                    </button>
                                    <button type="button" id="btnRegresar" ng-click="btnRegresarClick()" ng-hide="hide_btnRegresar" class="btn btn-sm btn-purple" style="font-size:10pt;background-color:rgb(238,37,34)!important;border-color:rgb(238,37,34)!important;">
                                        <i class="ace-icon fa fa-backward"></i>
                                        Regresar
                                    </button>
                                </div>
                            </div>
                            <br />
                            <div class="row">
                                <div class="col-md-12" style="padding:4px;">
                                    <div class="ui-dialog" style="padding:10px;">
                                        <div class="row">
                                            <div class="col-md-4">
                                                &nbsp;&nbsp;&nbsp;Empresa:
                                            </div>
                                            <div class="col-md-8">
                                                <input type="text" id="txtNombre" ng-model="txtNombre" maxlength="200" placeholder="Empresa" class="col-md-12 form-control" ng-disabled="true" />
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-4">
                                                * Dirección Matriz:
                                            </div>
                                            <div class="col-md-8">
                                                <input type="text" id="txtDirMatriz" ng-model="txtDirMatriz" maxlength="200" placeholder="Dirección Matriz" class="col-md-12 form-control clsToUpper" ng-disabled="disableAllCtr" ng-required="true" oninvalid="setCustomValidity('Dirección Matriz es requerida')" oninput="setCustomValidity('')" />
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-4">
                                                &nbsp;&nbsp;&nbsp;Dirección Sucursal:
                                            </div>
                                            <div class="col-md-8">
                                                <input type="text" id="txtDirSucursal" ng-model="txtDirSucursal" maxlength="200" placeholder="Dirección Sucursal" class="col-md-12 form-control clsToUpper" ng-disabled="disableAllCtr" />
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-5">
                                                <br />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-5">
                            <div class="row">
                                <div class="col-md-12">
                                    <img id="imgProveedor" ng-src="{{imgProveedor}}" alt="Imagen del Proveedor" style="height:95px;width:282px;" />
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12" style="padding:4px;">
                                    <div class="ui-dialog" style="padding:10px;">
                                        <div class="row">
                                            <div class="col-md-5">
                                                &nbsp;&nbsp;&nbsp;RUC:
                                            </div>
                                            <div class="col-md-7">
                                                <input type="text" id="txtRuc" ng-model="txtRuc" maxlength="13" placeholder="RUC" class="col-md-12 form-control" ng-disabled="true" />
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-5">
                                                * Número de Factura:
                                                @*<label data-toggle="tooltip" data-placement="bottom" title="Factura Compensación Solidaria 2%">
                                                    <input type="checkbox" class="ace form-control" id="chkcompesacion" ng-model="chkcompesacion" ng-click="funcCalculaTotn()" />
                                                    <span class="lbl" data-toggle="tooltip" data-placement="bottom" title="Factura Desc. Solidario 2% IVA"></span>
                                                </label>*@
                                            </div>
                                            <div class="col-md-7">
                                                <input type="text" id="txtFacEstabl" ng-model="txtFacEstabl" maxlength="3" placeholder="Est." class="col-md-2 form-control" ng-disabled="disableFactCtr" only-digits ng-required="true" style="width:20%;display:inline;" oninvalid="setCustomValidity('Establecimiento de la Factura es requerido')" oninput="setCustomValidity('')" />
                                                <input type="text" id="txtFacPtoEmi" ng-model="txtFacPtoEmi" maxlength="3" placeholder="P.E." class="col-md-2 form-control" ng-disabled="disableFactCtr" only-digits ng-required="true" style="width:20%;display:inline;" oninvalid="setCustomValidity('Punto de Emisión de la Factura es requerido')" oninput="setCustomValidity('')" />
                                                <input type="text" id="txtFacNumSec" ng-model="txtFacNumSec" maxlength="9" placeholder="Secuencial" class="col-md-8 form-control" ng-disabled="disableFactCtr" only-digits ng-required="true" style="width:60%;display:inline;" oninvalid="setCustomValidity('Secuencial de la Factura es requerido')" oninput="setCustomValidity('')" />
                                            </div>
                                        </div>
                                        <div class="row" ng-hide="true">
                                            <div class="col-md-5">
                                                &nbsp;&nbsp;&nbsp;Descuento Solidario:
                                                <label data-toggle="tooltip" data-placement="bottom" title="Factura Compensación Solidaria 2%">
                                                    <input type="checkbox" class="ace form-control" id="chkcompesacion" ng-model="chkcompesacion" ng-click="funcCalculaTotn()" />
                                                    <span class="lbl" data-toggle="tooltip" data-placement="bottom" title="Factura Desc. Solidario 2% IVA"></span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div style="display:none">
                        <input type="text" id="txtporcentaje" ng-model="porcentaje"  />
                    </div>
                    <div class="row">
                        <div class="col-md-12" style="padding:4px;">
                            <div class="ui-dialog" style="padding:10px;">
                                <div class="row">
                                    <div class="col-md-7">
                                        <div class="row">
                                            <div class="col-md-4">
                                                &nbsp;&nbsp;&nbsp;Razón social:
                                            </div>
                                            <div class="col-md-8">
                                                <input type="text" id="txtRazonSoc" ng-model="txtRazonSoc" maxlength="200" placeholder="Razón social" class="col-md-12 form-control" ng-disabled="true" />
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-4">
                                                &nbsp;&nbsp;&nbsp;Almacén Origen:
                                            </div>
                                            <div class="col-md-8">
                                                <div class="row">
                                                    <div class="col-md-3" style="padding-right:0px;">
                                                        <input type="text" id="txtAlmacenOrigenCod" ng-model="txtAlmacenOrigenCod" maxlength="4" placeholder="Alm.Orig." class="col-md-12 form-control" ng-disabled="true" />
                                                    </div>
                                                    <div class="col-md-9" style="padding-left:0px;">
                                                        <input type="text" id="txtAlmacenOrigenDes" ng-model="txtAlmacenOrigenDes" maxlength="30" placeholder="Almacén Origen" class="col-md-12 form-control" ng-disabled="true" />
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-8">
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        * Fecha de Emisión
                                                    </div>
                                                    <div class="col-md-6">
                                                        <input type="date" id="txtFechaEmision" ng-model="txtFechaEmision" ng-change="cambioFecha()" maxlength="10" placeholder="Fecha de Emisión" class="form-control" ng-disabled="disableAllCtr" ng-required="true" oninvalid="setCustomValidity('Fecha de Emisión es requerida')" oninput="setCustomValidity('')" />
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        &nbsp;&nbsp;&nbsp;No. Pedido:
                                                    </div>
                                                    <div class="col-md-6">
                                                        <input type="text" id="txtNumPedido" ng-model="txtNumPedido" maxlength="10" placeholder="No. Pedido" class="col-md-12 form-control" ng-disabled="true" />
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-4" style="padding-left:0px;">
                                                <div class="ui-dialog" style="padding:1px;margin-top:1px;border-radius:10px;">
                                                    <div class="row">
                                                        <div class="col-md-12">
                                                            Saldo Pendiente:
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-md-12">
                                                            <input type="text" id="txtSaldoPendFact" value="{{pValSaldoPendFact| number:'2'}}" maxlength="100" placeholder="Saldo Pendiente" class="col-md-12 form-control" style="border-radius:8px!important" ng-disabled="true" />
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-5">
                                        <div class="row">
                                            <div class="col-md-7">
                                                &nbsp;&nbsp;&nbsp;Identificación / RUC:
                                            </div>
                                            <div class="col-md-5">
                                                <input type="text" id="txtIdentificacion" ng-model="txtIdentificacion" maxlength="13" placeholder="Identificación / RUC" class="col-md-12 form-control" ng-disabled="true" />
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-7">
                                                * No. Autorización SRI:
                                            </div>
                                            <div class="col-md-5">
                                                <input type="text" id="txtNumAutorizaTal" ng-model="txtNumAutorizaTal" maxlength="10" placeholder="No. Autorización SRI" class="col-md-12 form-control" ng-disabled="disableAllCtr" only-digits ng-required="true" oninvalid="setCustomValidity('No. Autorización SRI es requerido')" oninput="setCustomValidity('')" />
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-7">
                                                * Fecha Inicio Vigencia Autorización SRI:
                                            </div>
                                            <div class="col-md-5">
                                                <input type="date" id="txtFechaIniVigAut" ng-model="txtFechaIniVigAut" maxlength="10" placeholder="Fecha Ini.Vig.Autoriza.SRI" class="form-control" ng-disabled="disableAllCtr" ng-required="true" oninvalid="setCustomValidity('Fecha Inicio Vigencia Autorización SRI es requerida')" oninput="setCustomValidity('')" />
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-7">
                                                * Fecha Fin Vigencia Autorización SRI:
                                            </div>
                                            <div class="col-md-5">
                                                <input type="date" id="txtFechaFinVigAut" ng-model="txtFechaFinVigAut" maxlength="10" placeholder="Fecha Fin.Vig.Autoriza.SRI" class="form-control" ng-disabled="disableAllCtr" ng-required="true" oninvalid="setCustomValidity('Fecha Fin Vigencia Autorización SRI es requerida')" oninput="setCustomValidity('')" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-12" style="padding:4px;">
                            <div class="ui-dialog" style="padding:10px;">
                                @*<div class="row">
                                        <div class="col-md-12" style="text-align:center;">
                                            <button type="button" id="btnVerItemsDisp" class="btn btn-sm btn-round"
                                                    style="background-color:rgb(238,37,34)!important;border-color:rgb(238,37,34)!important;"
                                                    create-pages results="resDgItemsDisp" number-per-page="15" pages="pagesItemsDisp"
                                                    page-content="pgcDgItemsDisp;" page-limit="67" binding="blur"
                                                    ng-click="btnVerItemsDispClick(); showPaginate=true;">
                                                <i class="glyphicon glyphicon-zoom-out"></i>
                                                Consultar Ítems Disponibles
                                            </button>
                                        </div>
                                    </div>*@
                                <div class="row">
                                    <div class="col-md-12">
                                        <div id="accordion" class="accordion-style1 panel-group">
                                            <div class="panel panel-default">
                                                <div class="panel-heading">
                                                    <h4 class="panel-title" style="text-align:center;">
                                                        <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion" href="#collapse_01"
                                                           create-pages results="resDgItemsDisp" number-per-page="15" pages="pagesItemsDisp"
                                                           page-content="pgcDgItemsDisp;" page-limit="67" binding="blur"
                                                           ng-click="showPaginate=true;" id="lnkAccordion">
                                                            <i class="ace-icon fa fa-angle-down bigger-110" data-icon-hide="ace-icon fa fa-angle-down" data-icon-show="ace-icon fa fa-angle-right"></i>
                                                            &nbsp;Ítems Disponibles:&nbsp;
                                                            <font ng-hide="etiTotRegistros==''">({{etiTotRegistros}} Registros)</font>
                                                        </a>
                                                    </h4>
                                                </div>
                                                <div class="panel-collapse collapse in" id="collapse_01">
                                                    <div class="panel-body">

                                                        <div class="widget-body">
                                                            <div class="widget-main">

                                                                <div ng-show="showPaginate">
                                                                    <div id="no-more-tables">
                                                                        <table class="table table-striped table-bordered table-hover gridStyle">
                                                                            <thead>
                                                                                <tr>
                                                                                    <th class="grid-header uppercase info" style="font-size:11px;text-align:center;">
                                                                                        <a href="#" ng-click="sortType = 'item'; sortReverse = !sortReverse">
                                                                                            Ítem
                                                                                            <span ng-show="sortType == 'item' && !sortReverse" class="fa fa-caret-down"></span>
                                                                                            <span ng-show="sortType == 'item' && sortReverse" class="fa fa-caret-up"></span>
                                                                                        </a>
                                                                                    </th>
                                                                                    <th class="grid-header uppercase info" style="font-size:11px;text-align:center;">
                                                                                        <a href="#" ng-click="sortType = 'codArticulo'; sortReverse = !sortReverse">
                                                                                            Código Producto
                                                                                            <span ng-show="sortType == 'codArticulo' && !sortReverse" class="fa fa-caret-down"></span>
                                                                                            <span ng-show="sortType == 'codArticulo' && sortReverse" class="fa fa-caret-up"></span>
                                                                                        </a>
                                                                                    </th>
                                                                                    <th class="grid-header uppercase info" style="font-size:11px;text-align:center;">
                                                                                        <a href="#" ng-click="sortType = 'desArticulo'; sortReverse = !sortReverse">
                                                                                            Descripción Producto
                                                                                            <span ng-show="sortType == 'desArticulo' && !sortReverse" class="fa fa-caret-down"></span>
                                                                                            <span ng-show="sortType == 'desArticulo' && sortReverse" class="fa fa-caret-up"></span>
                                                                                        </a>
                                                                                    </th>
                                                                                    <th class="grid-header uppercase info" style="font-size:11px;text-align:center;">
                                                                                        <a href="#" ng-click="sortType = 'cantPedido'; sortReverse = !sortReverse">
                                                                                            Cantidad Pedida
                                                                                            <span ng-show="sortType == 'cantPedido' && !sortReverse" class="fa fa-caret-down"></span>
                                                                                            <span ng-show="sortType == 'cantPedido' && sortReverse" class="fa fa-caret-up"></span>
                                                                                        </a>
                                                                                    </th>
                                                                                    <th class="grid-header uppercase info" style="font-size:11px;text-align:center;">
                                                                                        <a href="#" ng-click="sortType = 'precioCosto'; sortReverse = !sortReverse">
                                                                                            Precio Unitario
                                                                                            <span ng-show="sortType == 'precioCosto' && !sortReverse" class="fa fa-caret-down"></span>
                                                                                            <span ng-show="sortType == 'precioCosto' && sortReverse" class="fa fa-caret-up"></span>
                                                                                        </a>
                                                                                    </th>
                                                                                    <th class="grid-header uppercase info" style="font-size:11px;text-align:center;">
                                                                                        <a href="#" ng-click="sortType = 'tamanoCaja'; sortReverse = !sortReverse">
                                                                                            Tamaño por Caja
                                                                                            <span ng-show="sortType == 'tamanoCaja' && !sortReverse" class="fa fa-caret-down"></span>
                                                                                            <span ng-show="sortType == 'tamanoCaja' && sortReverse" class="fa fa-caret-up"></span>
                                                                                        </a>
                                                                                    </th>
                                                                                    <th class="grid-header uppercase info" style="font-size:11px;text-align:center;">
                                                                                        <a href="#" ng-click="sortType = 'descuento1'; sortReverse = !sortReverse">
                                                                                            Descuento 1
                                                                                            <span ng-show="sortType == 'descuento1' && !sortReverse" class="fa fa-caret-down"></span>
                                                                                            <span ng-show="sortType == 'descuento1' && sortReverse" class="fa fa-caret-up"></span>
                                                                                        </a>
                                                                                    </th>
                                                                                    <th class="grid-header uppercase info" style="font-size:11px;text-align:center;">
                                                                                        <a href="#" ng-click="sortType = 'descuento2'; sortReverse = !sortReverse">
                                                                                            Descuento 2
                                                                                            <span ng-show="sortType == 'descuento2' && !sortReverse" class="fa fa-caret-down"></span>
                                                                                            <span ng-show="sortType == 'descuento2' && sortReverse" class="fa fa-caret-up"></span>
                                                                                        </a>
                                                                                    </th>
                                                                                    <th class="grid-header uppercase info" style="font-size:11px;text-align:center;">
                                                                                        <a href="#" ng-click="sortType = 'indIva1Des'; sortReverse = !sortReverse">
                                                                                            IVA
                                                                                            <span ng-show="sortType == 'indIva1Des' && !sortReverse" class="fa fa-caret-down"></span>
                                                                                            <span ng-show="sortType == 'indIva1Des' && sortReverse" class="fa fa-caret-up"></span>
                                                                                        </a>
                                                                                    </th>
                                                                                    <th class="grid-header uppercase info" style="font-size:11px;text-align:center;">
                                                                                        <a href="#" ng-click="sortType = 'subTotalItem'; sortReverse = !sortReverse">
                                                                                            Subtotal
                                                                                            <span ng-show="sortType == 'subTotalItem' && !sortReverse" class="fa fa-caret-down"></span>
                                                                                            <span ng-show="sortType == 'subTotalItem' && sortReverse" class="fa fa-caret-up"></span>
                                                                                        </a>
                                                                                    </th>
                                                                                    <th class="grid-header uppercase info" style="font-size:11px;text-align:center;">
                                                                                        <a href="#" ng-click="sortType = 'totalItem'; sortReverse = !sortReverse">
                                                                                            Total
                                                                                            <span ng-show="sortType == 'totalItem' && !sortReverse" class="fa fa-caret-down"></span>
                                                                                            <span ng-show="sortType == 'totalItem' && sortReverse" class="fa fa-caret-up"></span>
                                                                                        </a>
                                                                                    </th>
                                                                                </tr>
                                                                            </thead>
                                                                            <tbody>
                                                                                <tr ng-repeat="row in pgcDgItemsDisp | orderBy:sortType:sortReverse">
                                                                                    <td style="font-size:11px;text-align:left;" data-title="ITEM">{{row.item}}</td>
                                                                                    <td style="font-size:11px;text-align:left;" data-title=" CÓDIGO PRODUCTO">{{row.codArticulo}}</td>
                                                                                    <td style="font-size:11px;text-align:left;" data-title="DESCRIPCIÓN PRODUCTO">{{row.desArticulo}}</td>
                                                                                    <td style="font-size:11px;text-align:right;" data-title="CANTIDAD PEDIDA">{{row.cantPedido| number:'2'}}</td>
                                                                                    <td style="font-size:11px;text-align:right;" data-title="PRECIO UNITARIO">{{row.precioCosto| number:'2'}}</td>
                                                                                    <td style="font-size:11px;text-align:center;" data-title="TAMAÑO UND X CAJA">{{row.tamanoCaja}}</td>
                                                                                    <td style="font-size:11px;text-align:right;" data-title="DESCUENTO 1">{{row.descuento1| number:'2'}}%</td>
                                                                                    <td style="font-size:11px;text-align:right;" data-title="DESCUENTO 2">{{row.descuento2| number:'2'}}%</td>
                                                                                    <td style="font-size:11px;text-align:right;" data-title="IVA">{{porcentaje}}.00%</td>
                                                                                    <td style="font-size:11px;text-align:right;" data-title="SUBTOTAL">{{row.subTotalItem| number:'2'}}</td>
                                                                                    <td style="font-size:11px;text-align:right;" data-title="TOTAL">{{row.totalItem| number:'2'}}</td>
                                                                                </tr>
                                                                            </tbody>
                                                                            <tfoot>
                                                                                <tr>
                                                                                    <td class="modal-footer"></td>
                                                                                    <td class="modal-footer"></td> @*style="text-align:right;font-weight:bold;color:darkgrey;">TOTAL:</td>*@
                                                                                    <td class="modal-footer"></td> @*style="text-align:left;font-weight:bold;color:darkgrey;">{{etiTotRegistros}} registros</td>*@
                                                                                    <td class="modal-footer"></td>
                                                                                    <td class="modal-footer"></td>
                                                                                    <td class="modal-footer"></td>
                                                                                    <td class="modal-footer"></td>
                                                                                    <td class="modal-footer"></td>
                                                                                    <td class="modal-footer" style="text-align:right;font-weight:bold;color:darkgrey;">SUBTOTAL:</td>
                                                                                    <td class="modal-footer" style="text-align:right;font-weight:bold;color:darkgrey;">{{pValTotalPedido| number:'2'}}</td>
                                                                                    <td class="modal-footer"></td>
                                                                                </tr>
                                                                            </tfoot>
                                                                        </table>
                                                                    </div>
                                                                    @*<ul style="position: relative;" class="pagination" ng-hide="pagesPedidos.length==0">
                                                                            <li ng-class="{disabled: isFirstPage()}" pagination-left><a>&laquo;</a></li>
                                                                            <li>
                                                                                <a> {{getCurrentPage()}} </a> <a>de</a> <a> {{pagesPedidos.length}}</a>
                                                                            </li>
                                                                            <li ng-class="{disabled: isLastPage()}" pagination-right><a>&raquo;</a></li>
                                                                        </ul>*@
                                                                    <ul style="position: relative;" class="pagination" ng-hide="pagesPedidos.length==0">

                                                                        <li pagination ng-class="[{active: page == getCurrentPage()}, {disabled: isFirstPage()} ]  " page="1">
                                                                            <a><div class="glyphicon glyphicon-fast-backward"></div></a>
                                                                        </li>
                                                                        <li ng-class="{disabled: isFirstPage()}" pagination-left><a><div class="glyphicon glyphicon-backward"></div></a></li>
                                                                        <li>
                                                                            <a> {{getCurrentPage()}} </a> <a>de</a> <a> {{pagesPedidos.length}}</a>
                                                                        </li>
                                                                        <li ng-class="{disabled: isLastPage()}" pagination-right><a><div class="glyphicon glyphicon-forward"></div></a></li>
                                                                        <li pagination ng-class="[{active: page == getCurrentPage()}, {disabled: isLastPage()} ]  " page="{{pagesPedidos.length}}">
                                                                            <a><div class="glyphicon glyphicon-fast-forward"></div></a>
                                                                        </li>
                                                                    </ul>

                                                                    @*<ul style="position: relative;" class="pagination">
                                                                            <li ng-class="{disabled: isFirstPage()}" pagination-left><a>&laquo;</a></li>
                                                                            <li pagination ng-class="{active: page == getCurrentPage() }" page="{{page}}" ng-repeat="page in pagesItemsDisp">
                                                                                <a>{{page}}</a>
                                                                            </li>
                                                                            <li ng-class="{disabled: isLastPage()}" pagination-right><a>&raquo;</a></li>
                                                                        </ul>*@
                                                                </div>

                                                            </div>
                                                        </div>

                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-12" style="padding:4px;text-align:center;">
                            <div class="ui-dialog" style="padding:10px;width:425px;margin:0 auto;text-align:left;">
                                <div class="row">
                                    <div class="col-md-8">
                                        * Subtotal {{porcentaje}}% IVA:
                                    </div>
                                    <div class="col-md-4">
                                        <input type="text" id="txtSubTot_12" ng-model="txtSubTot_12" maxlength="12" class="col-md-12 form-control clsCtrlDecimal" ng-blur="funcCalculaTot()" ng-disabled="disableAllCtr" style="text-align:right;" tooltip="SUBTOTAL NO INCLUYE DESCUESTOS" />
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-8">
                                        * Subtotal 0% IVA:
                                    </div>
                                    <div class="col-md-4">
                                        <input type="text" id="txtSubTot_0" ng-model="txtSubTot_0" maxlength="12" class="col-md-12 form-control clsCtrlDecimal" ng-blur="funcCalculaTot()" ng-disabled="disableAllCtr" style="text-align:right;" tooltip="SUBTOTAL NO INCLUYE DESCUESTOS" />
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-8">
                                        &nbsp;&nbsp;Subtotal No Objeto IVA:
                                    </div>
                                    <div class="col-md-4">
                                        <input type="text" id="txtSubTotNoObjIva" ng-model="txtSubTotNoObjIva" maxlength="12" class="col-md-12 form-control" ng-disabled="true" style="text-align:right;" />
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-8">
                                        &nbsp;&nbsp;Subtotal Exento IVA:
                                    </div>
                                    <div class="col-md-4">
                                        <input type="text" id="txtSubTotExenIva" ng-model="txtSubTotExenIva" maxlength="12" class="col-md-12 form-control" ng-disabled="true" style="text-align:right;" />
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-8">
                                        &nbsp;&nbsp;Subtotal Sin Impuestos:
                                    </div>
                                    <div class="col-md-4">
                                        <input type="text" id="txtSubTotSinImp" ng-model="txtSubTotSinImp" maxlength="12" class="col-md-12 form-control" ng-disabled="true" style="text-align:right;" />
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-8">
                                        * Descuento (en base Subtotal {{porcentaje}}% IVA):
                                    </div>
                                    <div class="col-md-4">
                                        <input type="text" id="txtDescuento_12" ng-model="txtDescuento_12" maxlength="12" class="col-md-12 form-control clsCtrlDecimal" ng-blur="funcCalculaTot()" ng-disabled="disableAllCtr" style="text-align:right;" />
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-8">
                                        * Descuento (en base Subtotal  0% IVA):
                                    </div>
                                    <div class="col-md-4">
                                        <input type="text" id="txtDescuento_0" ng-model="txtDescuento_0" maxlength="12" class="col-md-12 form-control clsCtrlDecimal" ng-blur="funcCalculaTot()" ng-disabled="disableAllCtr" style="text-align:right;" />
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-8">
                                        &nbsp;&nbsp;Total Descuento:
                                    </div>
                                    <div class="col-md-4">
                                        <input type="text" id="txtTotDescuento" ng-model="txtTotDescuento" maxlength="12" class="col-md-12 form-control" ng-disabled="true" style="text-align:right;" />
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-8">
                                        * ICE:
                                    </div>
                                    <div class="col-md-4">
                                        <input type="text" id="txtIce" ng-model="txtIce" maxlength="12" class="col-md-12 form-control clsCtrlDecimal" ng-blur="funcCalculaTot()" ng-disabled="disableAllCtr" style="text-align:right;" />
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-8">
                                        &nbsp;&nbsp;IVA {{porcentaje}}%:
                                    </div>
                                    <div class="col-md-4">
                                        <input type="text" id="txtIva_12" ng-model="txtIva_12" maxlength="12" class="col-md-12 form-control" ng-disabled="true" style="text-align:right;" />
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-8">
                                        * IRBPNR (en base Subtotal {{porcentaje}}% IVA):
                                    </div>
                                    <div class="col-md-4">
                                        <input type="text" id="txtIrbpnr_12" ng-model="txtIrbpnr_12" maxlength="12" class="col-md-12 form-control clsCtrlDecimal" ng-blur="funcCalculaTot()" ng-disabled="disableAllCtr" style="text-align:right;" />
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-8">
                                        * IRBPNR (en base Subtotal  0% IVA):
                                    </div>
                                    <div class="col-md-4">
                                        <input type="text" id="txtIrbpnr_0" ng-model="txtIrbpnr_0" maxlength="12" class="col-md-12 form-control clsCtrlDecimal" ng-blur="funcCalculaTot()" ng-disabled="disableAllCtr" style="text-align:right;" />
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-8">
                                        &nbsp;&nbsp;Total IRBPNR:
                                    </div>
                                    <div class="col-md-4">
                                        <input type="text" id="txtTotIrbpnr" ng-model="txtTotIrbpnr" maxlength="12" class="col-md-12 form-control" ng-disabled="true" style="text-align:right;" />
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-8">
                                        &nbsp;&nbsp;Propina:
                                    </div>
                                    <div class="col-md-4">
                                        <input type="text" id="txtPropina" ng-model="txtPropina" maxlength="12" class="col-md-12 form-control" ng-disabled="true" style="text-align:right;" />
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-8">
                                        &nbsp;&nbsp;Valor Total:
                                    </div>
                                    <div class="col-md-4">
                                        <input type="text" id="txtValTotal" ng-model="txtValTotal" maxlength="12" class="col-md-12 form-control" ng-disabled="true" style="text-align:right;" />
                                    </div>
                                </div>
                                <div class="row" ng-hide="hidecompesacion">
                                    <div class="col-md-8">
                                        &nbsp;&nbsp;(-)Desc. Solidario 2% IVA:
                                    </div>
                                    <div class="col-md-4">
                                        <input type="text" id="txtcompesacion" ng-model="txtcompesacion" maxlength="12" class="col-md-12 form-control" ng-disabled="true" style="text-align:right;" />
                                    </div>
                                </div>
                                <div class="row" ng-hide="hidecompesacion">
                                    <div class="col-md-8">
                                        &nbsp;&nbsp;Valor a pagar:
                                    </div>
                                    <div class="col-md-4">
                                        <input type="text" id="txtValPagado" ng-model="txtValPagado" maxlength="12" class="col-md-12 form-control" ng-disabled="true" style="text-align:right;" />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-12">
                            &nbsp;
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-12">
                            <button type="submit" id="btnGrabar_COPY" ng-click="btnGrabarClick()" ng-hide="hide_btnGrabar" class="btn btn-sm btn-purple" style="font-size:10pt;background-color:rgb(238,37,34)!important;border-color:rgb(238,37,34)!important;">
                                <i class="ace-icon glyphicon glyphicon-floppy-disk"></i>
                                Grabar
                            </button>
                            <button type="submit" id="btnEnviar_COPY" ng-click="btnEnviarClick()" ng-hide="hide_btnEnviar" class="btn btn-sm btn-purple" style="font-size:10pt;background-color:rgb(238,37,34)!important;border-color:rgb(238,37,34)!important;">
                                <i class="ace-icon fa fa-send"></i>
                                Enviar
                            </button>
                            <button type="button" id="btnAnular_COPY" ng-click="btnAnularClick()" ng-hide="hide_btnAnular" class="btn btn-sm btn-purple" style="font-size:10pt;background-color:rgb(238,37,34)!important;border-color:rgb(238,37,34)!important;">
                                <i class="ace-icon fa fa-close"></i>
                                Anular
                            </button>
                            <button type="button" id="btnModificar_COPY" ng-click="btnModificarClick()" ng-hide="hide_btnModificar" class="btn btn-sm btn-purple" style="font-size:10pt;background-color:rgb(238,37,34)!important;border-color:rgb(238,37,34)!important;">
                                <i class="ace-icon fa fa-pencil"></i>
                                Modificar/Anular
                            </button>
                            <button type="button" id="btnGetXML_COPY" ng-click="btnGetXMLClick()" ng-hide="hide_btnGetXML" class="btn btn-sm btn-purple" style="font-size:10pt;background-color:rgb(238,37,34)!important;border-color:rgb(238,37,34)!important;">
                                <i class="ace-icon fa fa-download"></i>
                                Descargar XML
                            </button>
                            <button type="button" id="btnGetPDF_COPY" ng-click="btnGetPDFClick()" ng-hide="hide_btnGetPDF" class="btn btn-sm btn-purple" style="font-size:10pt;background-color:rgb(238,37,34)!important;border-color:rgb(238,37,34)!important;" tooltip="DESCARGAR LA REPRESENTACIÓN IMPRESA NO ELECTRÓNICA">
                                <i class="ace-icon fa fa-download"></i>
                                Descargar RINE
                            </button>
                            <button type="button" id="btnRegresar_COPY" ng-click="btnRegresarClick()" ng-hide="hide_btnRegresar" class="btn btn-sm btn-purple" style="font-size:10pt;background-color:rgb(238,37,34)!important;border-color:rgb(238,37,34)!important;">
                                <i class="ace-icon fa fa-backward"></i>
                                Regresar
                            </button>
                        </div>
                    </div>

                </div>

            </div>

        </form>

        @Html.Partial("_mensajeError")
        @Html.Partial("_mensajeInformativo")
        @Html.Partial("_mensajeOK")
        @Html.Partial("_mensajeConfirmacion")

    </div>
</body>
@section scripts{
<script src="~/Scripts/angular-ui/ui-bootstrap-custom-tpls-0.10.0.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {

            $('[data-toggle=tooltip]').hover(function () {
                // on mouseenter
                $(this).tooltip('show');
            }, function () {
                // on mouseleave
                $(this).tooltip('hide');
            });

            //esto funciona bien, pero se ha elegido otro datepicker
            //$("#txtFechaEmision").datepicker("option", "dateFormat", 'dd-mm-yyyy');
            //$("#txtFechaIniVigAut").datepicker("option", "dateFormat", 'dd-mm-yyyy');
            //$("#txtFechaFinVigAut").datepicker("option", "dateFormat", 'dd-mm-yyyy');

            $('.clsToUpper').keyup(function () {
                this.value = this.value.toUpperCase();
            });

            $('.clsCtrlDecimal').numeric(".");

            $('.panel-collapse').collapse('hide');

            // INI - FUNCIONALIDAD AUTOCALCULO DE TOTALES ///////////////////////////////////////////////////////
            //Globalize.culture("en-EN");
            function roundToTwo(num) {
                return +(Math.round(num + "e+2") + "e-2");
            }
            var funcCalculaTot = function () {
                var subTotal_0 = parseFloat($("#txtSubTot_0").val());
                var subTotal_12 = parseFloat($("#txtSubTot_12").val());
                var descuento_0 = parseFloat($("#txtDescuento_0").val());
                var descuento_12 = parseFloat($("#txtDescuento_12").val());
                var ice = parseFloat($("#txtIce").val());
                var irbpnr_0 = parseFloat($("#txtIrbpnr_0").val());
                var irbpnr_12 = parseFloat($("#txtIrbpnr_12").val());
                var por = parseFloat($("#txtporcentaje").val())/100;
                if (isNaN(subTotal_0)) subTotal_0 = parseFloat("0");
                if (isNaN(subTotal_12)) subTotal_12 = parseFloat("0");
                if (isNaN(descuento_0)) descuento_0 = parseFloat("0");
                if (isNaN(descuento_12)) descuento_12 = parseFloat("0");
                if (isNaN(ice)) ice = parseFloat("0");
                if (isNaN(irbpnr_0)) irbpnr_0 = parseFloat("0");
                if (isNaN(irbpnr_12)) irbpnr_12 = parseFloat("0");
                var compesacion = 0;
                if ($("#chkcompesacion").is(":checked") == true)
                {
                    compesacion = (subTotal_12 - descuento_12 + ice) * parseFloat("0.02");
                    if (isNaN(compesacion)) compesacion = parseFloat("0");

                    $("#txtcompesacion").val(roundToTwo(compesacion));
                } else
                    $("#txtcompesacion").val(roundToTwo(compesacion));

                

                var iva_12 = (subTotal_12 - descuento_12 + ice) * parseFloat(por);
                var valTotal = (subTotal_0 + subTotal_12) - (descuento_0 + descuento_12) + iva_12;
                valTotal = valTotal + ice + irbpnr_0 + irbpnr_12;

                var valTotal1 = (subTotal_0 + subTotal_12) - (descuento_0 + descuento_12) + iva_12;
                valTotal1 = valTotal1 + ice + irbpnr_0 + irbpnr_12 - compesacion;


                $("#txtValPagado").val(valTotal1.toFixed(2));

                $("#txtSubTotSinImp").val((subTotal_12 + subTotal_0).toFixed(2));
                $("#txtTotDescuento").val((descuento_0 + descuento_12).toFixed(2));
                $("#txtTotIrbpnr").val((irbpnr_0 + irbpnr_12).toFixed(2));
                $("#txtIva_12").val(iva_12.toFixed(2));
                $("#txtValTotal").val(valTotal.toFixed(2));

                $("#txtSubTot_0").val(subTotal_0.toFixed(2));
                $("#txtSubTot_12").val(subTotal_12.toFixed(2));
                $("#txtDescuento_0").val(descuento_0.toFixed(2));
                $("#txtDescuento_12").val(descuento_12.toFixed(2));
                $("#txtIce").val(ice.toFixed(2));
                $("#txtIrbpnr_0").val(irbpnr_0.toFixed(2));
                $("#txtIrbpnr_12").val(irbpnr_12.toFixed(2));

                $("#txtSubTotSinImp").trigger('input');
                $("#txtTotDescuento").trigger('input');
                $("#txtTotIrbpnr").trigger('input');
                $("#txtIva_12").trigger('input');
                $("#txtValTotal").trigger('input');

                $("#txtSubTot_0").trigger('input');
                $("#txtSubTot_12").trigger('input');
                $("#txtDescuento_0").trigger('input');
                $("#txtDescuento_12").trigger('input');
                $("#txtIce").trigger('input');
                $("#txtIrbpnr_0").trigger('input');
                $("#txtIrbpnr_12").trigger('input');
            };

            $("#chkcompesacion").change(funcCalculaTot);

            $("#txtSubTot_0").change(funcCalculaTot);
            $("#txtSubTot_12").change(funcCalculaTot);
            $("#txtDescuento_0").change(funcCalculaTot);
            $("#txtDescuento_12").change(funcCalculaTot);
            $("#txtIce").change(funcCalculaTot);
            $("#txtIrbpnr_0").change(funcCalculaTot);
            $("#txtIrbpnr_12").change(funcCalculaTot);

            $("#txtSubTotNoObjIva").attr("disabled", true);
            $("#txtSubTotExenIva").attr("disabled", true);
            $("#txtSubTotSinImp").attr("disabled", true);
            $("#txtTotDescuento").attr("disabled", true);

            $("#txtIva_12").attr("disabled", true);
            $("#txtTotIrbpnr").attr("disabled", true);
            $("#txtPropina").attr("disabled", true);
            $("#txtValTotal").attr("disabled", true);

            var funcEnviaValorTotales = function () {
                bgColorCtr = $("#txtSubTotNoObjIva").css("background-color");

                $("#txtSubTotNoObjIva").attr("disabled", false);
                $("#txtSubTotExenIva").attr("disabled", false);
                $("#txtSubTotSinImp").attr("disabled", false);
                $("#txtTotDescuento").attr("disabled", false);

                $("#txtIva_12").attr("disabled", false);
                $("#txtTotIrbpnr").attr("disabled", false);
                $("#txtPropina").attr("disabled", false);
                $("#txtValTotal").attr("disabled", false);

                $("#txtSubTotNoObjIva").css("background-color", bgColorCtr);
                $("#txtSubTotExenIva").css("background-color", bgColorCtr);
                $("#txtSubTotSinImp").css("background-color", bgColorCtr);
                $("#txtTotDescuento").css("background-color", bgColorCtr);

                $("#txtIva_12").css("background-color", bgColorCtr);
                $("#txtTotIrbpnr").css("background-color", bgColorCtr);
                $("#txtPropina").css("background-color", bgColorCtr);
                $("#txtValTotal").css("background-color", bgColorCtr);
            };

            var default__doPostBack;
            default__doPostBack = __doPostBack;
            __doPostBack = function (eventTarget, eventArgument) {
                funcEnviaValorTotales.call();
                default__doPostBack.call(this, eventTarget, eventArgument);
            };

            var default_submit = $(document).submit();
            $(document).submit(function (eventObject) {
                funcEnviaValorTotales.call();
                if (default_submit.call) {
                    default_submit.call(this, eventObject);
                }
            });
            // FIN - FUNCIONALIDAD AUTOCALCULO DE TOTALES ///////////////////////////////////////////////////////

            // INI - FUNCIONALIDAD AUTOCOMPLETAR CEROS A LA IZQUIERDA ///////////////////////////////////////////
            var funcAutoCompleteLeftZero = function () {
                var MaxNumChr = $(this).attr('maxLength');
                var ActNumChr = $(this).val().length;
                if (ActNumChr > 0 && ActNumChr < MaxNumChr) {
                    var newValText = $(this).val();
                    for (var i = 0; i < MaxNumChr; i++) {
                        newValText = "0" + newValText;
                    }
                    $(this).val(newValText.substr(newValText.length - MaxNumChr, MaxNumChr));
                    $(this).trigger('input');
                }
            };
            $("#txtFacEstabl").change(funcAutoCompleteLeftZero);
            $("#txtFacPtoEmi").change(funcAutoCompleteLeftZero);
            $("#txtFacNumSec").change(funcAutoCompleteLeftZero);
            $("#txtNumAutorizaTal").change(funcAutoCompleteLeftZero);
            // FIN - FUNCIONALIDAD AUTOCOMPLETAR CEROS A LA IZQUIERDA ///////////////////////////////////////////
        });

        webshims.setOptions('waitReady', false);
        webshims.setOptions('forms-ext', { types: 'date' });
        webshims.polyfill('forms forms-ext');
        $.webshims.formcfg = {
            en: {
                dFormat: '/',
                dateSigns: '/',
                patterns: {
                    d: "dd/mm/yy"
                }
            }
        };

        $.webshims.activeLang('en');

    </script>
}
