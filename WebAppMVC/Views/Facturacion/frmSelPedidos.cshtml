@{
    ViewBag.Title = "Selección de Pedidos";
    Layout = "~/Views/Shared/_LayoutPrivado.cshtml";
}
@section styles{
    <link href="~/Content/Validation.css" rel="stylesheet" />
    <link href="~/assets/css/fileinput.css" rel="stylesheet" />
    <link href="~/assets/css/angular-busy.css" rel="stylesheet" />

}
@using WebAppMVC.Helper
<div class="breadcrumbs" id="breadcrumbs" style="top:0px;">
    <script type="text/javascript">
        try { ace.settings.check('breadcrumbs', 'fixed') } catch (e) { }
    </script>

    <ul class="breadcrumb">
        <li>
            <i class="ace-icon fa fa-home home-icon"></i>&nbsp;<a href="~/Notificacion/frmVisualizaNotificaciones">Inicio</a>
        </li>
        <li>
            <i class="ace-icon fa fa-money"></i>&nbsp;<a href="~/Home/IndexPrivado">Factura Manual</a>
        </li>
        <li>
            <i class="ace-icon glyphicon glyphicon-list-alt"></i>&nbsp;<a href="frmSelPedidos">Selección de Pedidos</a>
        </li>
        @*<li class="active">Profile 1</li>*@
    </ul><!-- /.breadcrumb -->
    <!-- #section:basics/content.searchbox -->
    <!-- /section:basics/content.searchbox -->
</div>
<div class="ace-settings-container" id="ace-settings-container">

    <div class="btn btn-app btn-xs btn-warning ace-settings-btn" id="ace-settings-btn">
        <i class="ace-icon glyphicon glyphicon-search bigger-130"></i>
    </div>

    <div class="ace-settings-box clearfix" id="ace-settings-box">

        <div class="container container-fluid" style="padding:0 0 0 0; width:280px;">

            <div class="row">
                <div class="col-md-12 col-xs-12 col-lg-12" style="height:10px;"></div>
            </div>

            <div class="row">
                <div class="col-md-12 col-xs-12 col-lg-12" style="text-align: right;">
                    <button type="button" id="btnConsulta" class="btn btn-sm btn-round tipo_letra"
                            style="background-color:rgb(238,37,34)!important;border-color:rgb(238,37,34)!important;"
                            create-pages results="resDgConsPed" number-per-page="15" pages="pagesConsPed"
                            page-content="pgcDgConsPed;" page-limit="9000" binding="blur"
                            ng-click="btnConsultaClick(); showPaginate=true;">
                        <i class="glyphicon glyphicon-search"></i>
                        Consultar
                    </button>
                </div>
            </div>

            <div class="row">
                <div class="col-md-12" style="height:7px;"></div>
            </div>

            <div class="row">
                <div class="col-md-12 col-xs-12 col-lg-12 titulos tipo_letra">
                    <span class="lbl">Estados</span>
                </div>
            </div>

            <div class="row">
                <div class="col-md-12 col-xs-12 col-lg-12 tipo_letra">
                    <label>
                        <input type="radio" name="FiltroEstados" class="ace form-control" id="rbtEstadosAll" ng-model="rbtEstados" value="T" />
                        <span class="lbl">Todos los Estados</span>
                    </label>
                </div>
            </div>

            <div class="row">
                <div class="col-md-5 col-xs-5 col-lg-5 tipo_letra">
                    <label>
                        <input type="radio" name="FiltroEstados" class="ace form-control" id="rbtEstadosSel" ng-model="rbtEstados" value="F" />
                        <span class="lbl">Por Estados:</span>
                    </label>
                </div>
                <div class="col-md-7 col-xs-7 col-lg-7 tipo_letra">
                    @*<select class="chosen-select form-control" id="cboEstados" data-placeholder="Seleccione un Estado.." ng-model="cboEstadosSelItem" ng-options="item as item.detalle for item in cboEstados" style="margin-left:30px;width:240px;"></select>*@
                    @*<div style="margin-left:30px;width:240px;">
                    </div>*@
                    <div ng-dropdown-multiselect="" options="chkEstadosList" checkboxes="true" selected-model="chkEstadosSelModel" extra-settings="chkEstadosSettings"></div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-12" style="height:5px;"></div>
            </div>

            <div class="row">
                <div class="col-md-12 col-xs-12 col-lg-12 titulos tipo_letra">
                    <span class="lbl">Fechas</span>
                </div>
            </div>

            <div class="row">
                <div class="col-md-12 col-xs-12 col-lg-12 tipo_letra">
                    <label>
                        <input type="radio" name="FiltroFechas" class="ace form-control" id="rbtFechasAll" ng-model="rbtFechas" value="T" />
                        <span class="lbl">Todas las Fechas</span>
                    </label>
                </div>
            </div>

            <div class="row">
                <div class="col-md-12 col-xs-12 col-lg-12 tipo_letra">
                    <label>
                        <input type="radio" name="FiltroFechas" class="ace form-control" id="rbtFechasRan" ng-model="rbtFechas" value="F" />
                        <span class="lbl">Rango de Fechas:</span>
                    </label>
                </div>
            </div>
            <div class="row">
                <div class="col-md-1">
                </div>
                <div class="col-md-4 tipo_letra">
                    <label>Desde:</label>
                </div>
                <div class="col-md-7 tipo_letra">
                    <div class="input-group">
                        <input class="form-control date-picker input-mask-date" id="txtFechaIni" type="text"  ng-model="txtFechaIni" maxlength="10" placeholder="Fecha Desde" data-date-format="dd/mm/yyyy" />
                        <span class=" input-group-addon">
                            <i class="fa fa-calendar small-1"></i>
                        </span>
                    </div>

                    @*<input type="date" id="txtFechaIni" ng-model="txtFechaIni" maxlength="10" placeholder="Fecha Desde" class="form-control" />*@
                </div>
            </div>
            <div class="row">
                <div class="col-md-1">
                </div>
                <div class="col-md-4 tipo_letra">
                    <label>Hasta:</label>
                </div>
                <div class="col-md-7 tipo_letra">
                    <div class="input-group">
                        <input class="form-control date-picker input-mask-date" id="txtFechaFin" type="text"  ng-model="txtFechaFin" maxlength="10" placeholder="Fecha Hasta" data-date-format="dd/mm/yyyy" />
                        <span class=" input-group-addon">
                            <i class="fa fa-calendar small-1"></i>
                        </span>
                    </div>
                    @*<input type="date" id="txtFechaFin" ng-model="txtFechaFin" maxlength="10" placeholder="Fecha Hasta" class="form-control" />*@
                </div>
            </div>

            <div class="row">
                <div class="col-md-12" style="height:5px;"></div>
            </div>

            <div class="row">
                <div class="col-md-12 col-xs-12 col-lg-12 titulos tipo_letra">
                    <span class="lbl">Almacenes</span>
                </div>
            </div>

            <div class="row">
                <div class="col-md-12 col-xs-12 col-lg-12 tipo_letra">
                    <label>
                        <input type="radio" name="FiltroAlmacen" class="ace form-control" id="rbtAmacenAll" ng-model="rbtAlmacen" value="T" />
                        <span class="lbl">Todos los Almacenes</span>
                    </label>
                </div>
            </div>

            <div class="row">
                <div class="col-md-5 col-xs-5 col-lg-5 tipo_letra">
                    <label>
                        <input type="radio" name="FiltroAlmacen" class="ace form-control" id="rbtAlmacenSel" ng-model="rbtAlmacen" value="F" />
                        <span class="lbl">Por Almacén:</span>
                    </label>
                </div>
                <div class="col-md-7 col-xs-7 col-lg-7 tipo_letra">
                    @*<select class="chosen-select form-control" id="cboEstados" data-placeholder="Seleccione un Estado.." ng-model="cboEstadosSelItem" ng-options="item as item.detalle for item in cboEstados" style="margin-left:30px;width:240px;"></select>*@
                    @*<div style="margin-left:30px;width:240px;">
                </div>*@
                    
                        <select class="chosen-select form-control " id="cboAlamcenL1" data-placeholder="Seleccione el almacén.."
                                ng-model="cboAlmacenSelItem1" ng-options="item as item.pNomAlmacen for item in cboAlmacenList1">
                            <option value="">Seleccione un Almacén</option>

                        </select>
                   
                </div>
            </div>

            <div class="row">
                <div class="col-md-12 col-xs-12 col-lg-12 titulos tipo_letra">
                    <span class="lbl">Pedidos</span>
                </div>
            </div>

            <div class="row">
                <div class="col-md-12 col-xs-12 col-lg-12 tipo_letra">
                    <label>
                        <input type="radio" name="FiltroPedidos" class="ace form-control" id="rbtPedidosAll" ng-model="rbtPedidos" value="T" />
                        <span class="lbl">Todos los Pedidos</span>
                    </label>
                </div>
            </div>

            <div class="row">
                <div class="col-md-5 tipo_letra">
                    <label>
                        <input type="radio" name="FiltroPedidos" class="ace form-control" id="rbtPedidosNro" ng-model="rbtPedidos" value="F" />
                        <span class="lbl" style="width:100px;">No. Pedido:</span>
                    </label>
                </div>
                <div class="col-md-7 tipo_letra">
                    <input type="text" name="Pedido" id="txtNumPedido" ng-model="txtNumPedido" maxlength="10" placeholder="No.Pedido" class="form-control" />
                </div>
            </div>

            <div class="row">
                <div class="col-md-12" style="height:20px;"></div>
            </div>

        </div>

    </div>

</div>
<body data-ng-controller="frmSelPedidosController" @Html.RequestVerificationToken()>

    <div cg-busy="{promise:myPromise,message:message,backdrop:true}">



        <div class='form-group'>
            <div class="widget-box">
                <div class="widget-header" style="text-align:center;text-wrap:none;">
                    <h4 class="widget-title">BANDEJA DE SELECCIÓN DE PEDIDOS</h4>
                    <div class="widget-toolbar">
                        <a href="#" data-action="collapse">
                            <i class="ace-icon fa fa-chevron-up"></i>
                        </a>
                    </div>
                    <font ng-hide="etiTotRegistros==''" class="widget-toolbar"> Total: {{etiTotRegistros}} Registros </font>
                </div>
                <div class="widget-body" ng-hide="etiTotRegistros!=''">
                    <div class="widget-main">
                        <div class="row">
                            <div class="col-md-12" style="text-align:center;">
                                @*<span class="panel-title">
                                        <strong>
                                            No existen datos para mostrar.
                                        </strong>
                                    </span>*@
                                @*<div ng-hide="etiTotRegistros==''">

                                    </div>*@
                            </div>
                        </div>
                    </div>
                </div>
                <div class="widget-body" ng-hide="etiTotRegistros==''">
                    <div class="widget-main">
                        <div ng-controller="PaginationController">
                            <div ng-show="showPaginate">
                                <div id="no-more-tables">
                                    <table class="table table-striped table-bordered table-hover gridStyle">
                                        <thead>
                                            <tr>
                                                <th class="grid-header uppercase info" style="text-align:center;font-size:11px">
                                                    <a href="#" ng-click="sortType = 'numPedido'; sortReverse = !sortReverse">
                                                        No. Pedido
                                                        <span ng-show="sortType == 'numPedido' && !sortReverse" class="fa fa-caret-down"></span>
                                                        <span ng-show="sortType == 'numPedido' && sortReverse" class="fa fa-caret-up"></span>
                                                    </a>
                                                </th>
                                                <th class="grid-header uppercase info" style="text-align:center;font-size:11px">
                                                    <a href="#" ng-click="sortType = 'fechaPedido'; sortReverse = !sortReverse">
                                                        Fecha Emisión
                                                        <span ng-show="sortType == 'fechaPedido' && !sortReverse" class="fa fa-caret-down"></span>
                                                        <span ng-show="sortType == 'fechaPedido' && sortReverse" class="fa fa-caret-up"></span>
                                                    </a>
                                                </th>
                                                <th class="grid-header uppercase info" style="text-align:center;font-size:11px">
                                                    <a href="#" ng-click="sortType = 'codAlmacen'; sortReverse = !sortReverse">
                                                        Cod. Almacén
                                                        <span ng-show="sortType == 'codAlmacen' && !sortReverse" class="fa fa-caret-down"></span>
                                                        <span ng-show="sortType == 'codAlmacen' && sortReverse" class="fa fa-caret-up"></span>
                                                    </a>
                                                </th>
                                                <th class="grid-header uppercase info" style="text-align:center;font-size:11px">
                                                    <a href="#" ng-click="sortType = 'nomAlmacen'; sortReverse = !sortReverse">
                                                        Nombre Almacén
                                                        <span ng-show="sortType == 'nomAlmacen' && !sortReverse" class="fa fa-caret-down"></span>
                                                        <span ng-show="sortType == 'nomAlmacen' && sortReverse" class="fa fa-caret-up"></span>
                                                    </a>
                                                </th>
                                                @*<th class="grid-header uppercase info" style="text-align:center;font-size:11px">
                                                    <a href="#" ng-click="sortType = 'codAlmDestino'; sortReverse = !sortReverse">
                                                        Cod. Alm. Destino
                                                        <span ng-show="sortType == 'codAlmDestino' && !sortReverse" class="fa fa-caret-down"></span>
                                                        <span ng-show="sortType == 'codAlmDestino' && sortReverse" class="fa fa-caret-up"></span>
                                                    </a>
                                                </th>*@
                                                <th class="grid-header uppercase info" style="text-align:center;font-size:11px">
                                                    <a href="#" ng-click="sortType = 'zonaOrigen'; sortReverse = !sortReverse">
                                                        Zona Origen
                                                        <span ng-show="sortType == 'zonaOrigen' && !sortReverse" class="fa fa-caret-down"></span>
                                                        <span ng-show="sortType == 'zonaOrigen' && sortReverse" class="fa fa-caret-up"></span>
                                                    </a>
                                                </th>
                                                <th class="grid-header uppercase info" style="text-align:center;font-size:11px">
                                                    <a href="#" ng-click="sortType = 'esDescargadoDes'; sortReverse = !sortReverse">
                                                        Descargado
                                                        <span ng-show="sortType == 'esDescargadoDes' && !sortReverse" class="fa fa-caret-down"></span>
                                                        <span ng-show="sortType == 'esDescargadoDes' && sortReverse" class="fa fa-caret-up"></span>
                                                    </a>
                                                </th>
                                                <th class="grid-header uppercase info" style="text-align:center;font-size:11px">
                                                    <a href="#" ng-click="sortType = 'esImpresoDes'; sortReverse = !sortReverse">
                                                        Impreso
                                                        <span ng-show="sortType == 'esImpresoDes' && !sortReverse" class="fa fa-caret-down"></span>
                                                        <span ng-show="sortType == 'esImpresoDes' && sortReverse" class="fa fa-caret-up"></span>
                                                    </a>
                                                </th>
                                                <th class="grid-header uppercase info" style="text-align:center;font-size:11px">
                                                    <a href="#" ng-click="sortType = 'valorTotalPedido'; sortReverse = !sortReverse">
                                                        Total Pedido
                                                        <span ng-show="sortType == 'valorTotalPedido' && !sortReverse" class="fa fa-caret-down"></span>
                                                        <span ng-show="sortType == 'valorTotalPedido' && sortReverse" class="fa fa-caret-up"></span>
                                                    </a>
                                                </th>
                                                <th class="grid-header uppercase info" style="text-align:center;font-size:11px">
                                                    <a href="#" ng-click="sortType = 'totalSumaFacturas'; sortReverse = !sortReverse">
                                                        Total Facturas
                                                        <span ng-show="sortType == 'totalSumaFacturas' && !sortReverse" class="fa fa-caret-down"></span>
                                                        <span ng-show="sortType == 'totalSumaFacturas' && sortReverse" class="fa fa-caret-up"></span>
                                                    </a>
                                                </th>
                                                <th class="grid-header uppercase info" style="text-align:center;font-size:11px">
                                                    <a href="#" ng-click="sortType = 'valorPendPedido'; sortReverse = !sortReverse">
                                                        Pendiente Pedido
                                                        <span ng-show="sortType == 'valorPendPedido' && !sortReverse" class="fa fa-caret-down"></span>
                                                        <span ng-show="sortType == 'valorPendPedido' && sortReverse" class="fa fa-caret-up"></span>
                                                    </a>
                                                </th>
                                                <th class="grid-header uppercase info" style="text-align:center;font-size:11px">
                                                    <a href="#" ng-click="sortType = 'estadoDes'; sortReverse = !sortReverse">
                                                        Estado
                                                        <span ng-show="sortType == 'estadoDes' && !sortReverse" class="fa fa-caret-down"></span>
                                                        <span ng-show="sortType == 'estadoDes' && sortReverse" class="fa fa-caret-up"></span>
                                                    </a>
                                                </th>
                                                <th class="grid-header uppercase info" style="text-align:center;font-size:11px">
                                                    <a href="#">
                                                        Editar
                                                    </a>
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr ng-repeat="row in pgcDgConsPed | orderBy:sortType:sortReverse"
                                                class="clsForeColor{{row.estado}}">
                                                <td style="font-size:11px" data-title="NO.PEDIDO">{{row.numPedido}}</td>
                                                <td style="font-size:11px;text-align:center;" data-title="FECHA EMISIÓN">{{row.fechaPedido| date:'dd/MM/yyyy'}}</td>
                                                <td style="font-size:11px;text-align:center;" data-title="COD. ALMACÉN">{{row.codAlmacen}}</td>
                                                <td style="font-size:11px" data-title="NOMBRE ALMACÉN">{{row.nomAlmacen}}</td>
                                                @*<td style="font-size:11px;text-align:center;" data-title="COD.ALM. DESTINO">{{row.codAlmDestino}}</td>*@
                                                <td style="font-size:11px;text-align:center;" data-title="ZONA ORIGEN">{{row.zonaOrigen}}</td>
                                                <td style="font-size:11px;text-align:center;" data-title="DESCARGADO">{{row.esDescargadoDes}}</td>
                                                <td style="font-size:11px;text-align:center;" data-title="IMPRESO">{{row.esImpresoDes}}</td>
                                                <td style="font-size:11px;text-align:right;" data-title="TOTAL PEDIDO">{{row.valorTotalPedido| number:'2'}}</td>
                                                <td style="font-size:11px;text-align:right;" data-title="TOTAL FACTURAS">{{row.totalSumaFacturas| number:'2'}}</td>
                                                <td style="font-size:11px;text-align:right;" data-title="PENDIENTE PEDIDO" >{{row.valorPendPedido| number:'2'}}</td>
                                                <td style="font-size:11px" data-title="ESTADO">{{row.estadoDes}}</td>
                                                <td style="font-size:11px" align="center" data-title="">
                                                    <a class="btn btn-danger btn-xs" ng-click="selRowGrid(row);" style="border-width: 1px;padding: 0 5px;">
                                                        <i class="fa fa-pencil"></i>
                                                    </a>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>

                                <ul style="position: relative;" class="pagination" ng-hide="pagesConsPed.length==0">

                                    <li pagination ng-class="[{active: page == getCurrentPage()}, {disabled: isFirstPage()} ]  " page="1">
                                        <a><div class="glyphicon glyphicon-fast-backward"></div></a>
                                    </li>
                                    <li ng-class="{disabled: isFirstPage()}" pagination-left><a><div class="glyphicon glyphicon-backward"></div></a></li>
                                    <li>
                                        <a> {{getCurrentPage()}} </a> <a>de</a> <a> {{pagesConsPed.length}}</a>
                                    </li>
                                    <li ng-class="{disabled: isLastPage()}" pagination-right><a><div class="glyphicon glyphicon-forward"></div></a></li>
                                    <li pagination ng-class="[{active: page == getCurrentPage()}, {disabled: isLastPage()} ]  " page="{{pagesConsPed.length}}">
                                        <a><div class="glyphicon glyphicon-fast-forward"></div></a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        @Html.Partial("_mensajeError")
        @Html.Partial("_mensajeInformativo")
        @Html.Partial("_mensajeOK")

    </div>
</body>
@section scripts{
    <script type="text/javascript">

        $('.date-picker').datepicker({
            minDate: new Date(1999, 10 - 1, 25),
            maxDate: '+30Y',
            autoclose: true,
            todayHighlight: true
        })
               //show datepicker when clicking on the icon
               .next().on(ace.click_event, function () {
                   $(this).prev().focus();
               });
        $('.input-mask-date').mask('99/99/9999');


        //$("#txtFechaIni").kendoDatePicker({
        //    format: "dd/MM/yyyy",
        //    //value: new Date(),
        //    animation: {
        //        close: {
        //            effects: "fadeOut zoom:out",
        //            duration: 300
        //        },
        //        open: {
        //            effects: "fadeIn zoom:in",
        //            duration: 300
        //        }
        //    }
        //});
        //$("#txtFechaIni").attr("readonly", true);
        //$("#txtFechaIni").kendoMaskedTextBox({
        //    mask: "00/00/0000"
        //});
        //$("#txtFechaFin").kendoDatePicker({
        //    format: "dd/MM/yyyy",
        //    //value: new Date(),
        //    animation: {
        //        close: {
        //            effects: "fadeOut zoom:out",
        //            duration: 300
        //        },
        //        open: {
        //            effects: "fadeIn zoom:in",
        //            duration: 300
        //        }
        //    }
        //});
        //$("#txtFechaFin").attr("readonly", true);
        //$("#txtFechaFin").kendoMaskedTextBox({
        //    mask: "00/00/0000"
        //});
        $(document).ready(function () {
            //esto funciona bien, pero se ha elegido otro datepicker
            //$("#txtFechaIni").datepicker("option", "dateFormat", 'dd-mm-yyyy');
            //$("#txtFechaFin").datepicker("option", "dateFormat", 'dd-mm-yyyy');

            $('#txtNumPedido').keypress(function (e) {
                var regex = new RegExp("^[a-zA-Z0-9]");
                var str = String.fromCharCode(!e.charCode ? e.which : e.charCode);
                if (regex.test(str)) {
                    return true;
                }
                e.preventDefault();
                return false;
            });
            $('#txtNumPedido').keyup(function () {
                this.value = this.value.toUpperCase();
            });

        });

        webshims.setOptions('waitReady', false);
        webshims.setOptions('forms-ext', { types: 'date' });
        webshims.polyfill('forms forms-ext');
        $.webshims.formcfg = {
            en: {
                dFormat: '/',
                dateSigns: '/',
                patterns: {
                    d: "dd/mm/yy"
                }
            }
        };

        $.webshims.activeLang('en');

    </script>
<style type="text/css">
    /*estilos para rows especiales del grid*/
    .clsForeColorFP {
        font-weight: bold;
        color: SaddleBrown;
    }
    .clsForeColorFT {
        font-weight: bold;
        color: SaddleBrown;
    }
    .clsForeColorVE {
        font-weight: bold;
        color: DarkGray;
    }
    .clsForeColorFI {
        font-weight: bold;
        color: DarkGray;
    }
    .clsForeColorPE {
        color: black;
    }
</style>
}
