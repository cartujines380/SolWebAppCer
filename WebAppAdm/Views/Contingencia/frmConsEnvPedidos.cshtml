@{
    ViewBag.Title = "Consulta y Envío Pedidos";
    Layout = "~/Views/Shared/_LayoutAdm.cshtml";
}
@section styles{
    <link href="~/Content/Validation.css" rel="stylesheet" />
    <link href="~/assets/css/fileinput.css" rel="stylesheet" />

}

@using WebAppMVC.Helper

<div class="breadcrumbs" id="breadcrumbs" style="top:0px;">
    <script type="text/javascript">
        try { ace.settings.check('breadcrumbs', 'fixed') } catch (e) { }
    </script>

    <ul class="breadcrumb">
        <li>
            <i class="ace-icon fa fa-home home-icon">
            </i>&nbsp;<a href="~/Home/Index">Inicio</a>
        </li>
        <li>
            <i class="menu-icon fa fa-shield"></i>
            <a href="~/Home/Index">Contingencia</a>
        </li>
        <li>
            <i class="menu-icon fa fa-external-link"></i>
            <a href="frmConsEnvPedidos">Consulta y Envío Pedidos</a>
        </li>
    </ul>
</div>

<body data-ng-controller="ConsEnvPedController" @Html.RequestVerificationToken() filters="queueLimit, customFilter">

    <div style="height:100%; ">
        <div class="ace-settings-container" id="ace-settings-container" >
            <div class="btn btn-app btn-xs btn-warning ace-settings-btn" id="ace-settings-btn">
                <i class="  glyphicon glyphicon-search "></i>
            </div>
            <div class="ace-settings-box clearfix" id="ace-settings-box">
                <div class="container container-fluid" style="padding:0 0 0 0">
                    <br/>
                    <div class="row">
                        <div class="col-md-3" style="text-align: right;">
                            <button type="button" class="btn btn-sm btn-round" id="btnConsultau" style="background-color:rgb(238,37,34)!important;border-color:rgb(238,37,34)!important" create-pages results="grPedido" number-per-page="1000" ng-click="CargaConsulta(1);showPaginate=true" pages="pagesPed" page-content="pageContentPed;" page-limit=15 binding="blur">
                                <i class=" glyphicon glyphicon-search"></i>
                                Consultar
                            </button>
                        </div>
                    </div>
                    <br />
                    <div class="row">
                        <div class="col-md-4 titulos">
                            <span class="lbl">Rango de Fechas</span>
                            <input type="radio" style="display:none" value="1" id="rbtTraTN" />
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-1">
                            <label>
                                <span class="lbl">Desde:</span>
                            </label>
                        </div>
                        <div class="col-md-2">
                            <div class="input-group">
                                <input class="form-control date-picker input-mask-date" name="mydate" id="txtFechaDesde" type="text" ng-model="txtFechaDesde" maxlength="10" placeholder="Fecha Desde" data-date-format="dd/mm/yyyy" />
                                <span class=" input-group-addon">
                                    <i class="fa fa-calendar small-1"></i>
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-1">
                            <label>
                                <span class="lbl">Hasta:</span>
                            </label>
                        </div>
                        <div class="col-md-2">
                            <div class="input-group">
                                <input class="form-control date-picker input-mask-date" name="mydate" id="txtFechaHasta" type="text" ng-model="txtFechaHasta" maxlength="10" placeholder="Fecha Desde" data-date-format="dd/mm/yyyy" />
                                <span class=" input-group-addon">
                                    <i class="fa fa-calendar small-1"></i>
                                </span>
                            </div>
                        </div>
                    </div>
                    <br />
                    <div class="row">
                        <div class="col-md-4 titulos">
                            <span class="lbl">Almacenes</span>
                            <input type="radio" style="display:none" value="1" id="rbtTraTN" />
                        </div>
                    </div>
                    <div class="row" >
                        
                        <div class="col-md-3" >
                            <div ng-dropdown-multiselect="" options="listaAlmacenes" checkboxes="true" selected-model="selecAlmacenes"
                                 extra-settings="SettingAlmacenes"></div>
                        </div>
                    </div>
                    <br />
                    <div class="row">
                        <div class="col-md-4 titulos">
                            <span class="lbl">Estado de la Orden</span>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-3 ">
                            <label>
                                <input type="radio" name="FiltrosGrupo2" class="ace form-control" id="rbtTodos" ng-model="pOpcGrp2" value="T" />
                                <span class="lbl">&nbsp;Todos</span>
                            </label>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-3 ">
                            <label>
                                <input type="radio" name="FiltrosGrupo2" class="ace form-control" id="rbtNuevos" ng-model="pOpcGrp2" value="N" />
                                <span class="lbl">&nbsp;Nuevos</span>
                            </label>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-3 ">
                            <label>
                                <input type="radio" name="FiltrosGrupo2" class="ace form-control" id="rbtDescarga" ng-model="pOpcGrp2" value="D" />
                                <span class="lbl">&nbsp;Descargados</span>
                            </label>
                        </div>
                    </div>
                    <div class="row" ng-hide="true">
                        <div class="col-md-4 titulos">
                            <span class="lbl">Estados</span>
                            <input type="radio" style="display:none" value="1" id="rbtTraTN" />
                        </div>
                    </div>
                    <div class="row" ng-hide="true">

                        <div class="col-md-3">
                            <div ng-dropdown-multiselect="" options="chkEstadosList" checkboxes="true" selected-model="chkEstadosSelModel" extra-settings="chkEstadosSettings"></div>
                        </div>
                    </div>
                    <br />
                    <div class="row">
                        <div class="col-md-4 titulos">
                            <span class="lbl">Proveedor</span>
                        </div>
                    </div>
                    <div class="row" ng-hide="true">
                        <div class="col-md-3">

                            <label>
                                <input type="radio" class="ace" ng-model="rdbProv" name="Todos" value="0" id="rbtTodos" checked="checked" />
                                <span class="lbl">Todos:</span>
                            </label>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-3">
                            
                            <label>
                                <input type="radio" class="ace" ng-model="rdbProv" name="PorRUC" value="1" id="rbtRucPro" checked="checked" />
                                <span class="lbl">RUC:</span>
                            </label>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-3">
                            <input type="text" name="Nombres" id="txtRuc" ng-model="txtRuc" placeholder="RUC Proveedor" style="  width: 100%; " maxlength="13"
                                   ng-required="true" onkeypress="if (event.keyCode < 45 || event.keyCode > 57) event.returnValue = false;" />
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-3">

                            <label>
                                <input type="radio" class="ace" ng-model="rdbProv" name="PorCodigo" value="2" id="rbtCodPro" checked="checked" />
                                <span class="lbl">Código de Proveedor:</span>
                            </label>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-3">
                            <input type="text" name="Codigo" id="txtCodigo" ng-model="txtCodigo" placeholder="Código Proveedor" style=" width: 100%; " maxlength="13"
                                   ng-required="true"  />
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-3">

                            <label>
                                <input type="radio" class="ace" ng-model="rdbProv" name="PorRUC" value="3" id="rbtRazPro" checked="checked" />
                                <span class="lbl">Razón Social:</span>
                            </label>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-3">
                            <input type="text" name="RazonSocial" id="txtRazonSocial" ng-model="txtRazonSocial" placeholder="Razón Social" style=" width: 100%; " maxlength="35"
                                   ng-required="true"  />


                        </div>
                    </div>
                    <br />
                    <div class="row">
                        <div class="col-md-4 titulos">
                            <span class="lbl">Órdenes de Compra</span>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-3">
                            <label>
                                <input type="radio" class="ace" ng-model="rdbPedid" name="TodosPed" value="0" id="rbtPTodos" checked="checked" />
                                <span class="lbl">Todos:</span>
                            </label>

                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-3">
                            <label>
                                <input type="radio" class="ace" ng-model="rdbPedid" name="NumPed" value="1" id="rbtPedid" checked="checked" />
                                <span class="lbl">Número de Orden:</span>
                            </label>
                            
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-3">
                            <input type="text" name="Pedido" id="txtPedido" ng-model="txtNumPedido" placeholder="Número de Orden" style=" width: 100%; " maxlength="10"
                                   ng-required="true"  />
                        </div>
                    </div>
                    <br />
                    <br />
                 
                </div>
            </div>
        </div>
    </div>
    <div cg-busy="{promise:myPromise,message:message,backdrop:true}">
        <div class="widget-box">
            <div class="widget-header">
                <h4 class="smaller" style="text-align:right;">
                    <button ng-hide="ContGrPedido=='' || ContGrPedido=='0' " type="button" class="btn btn-sm btn-round" style="background-color:rgb(238,37,34)!important;border-color:rgb(238,37,34)!important"
                            id="btnEnviar" ng-click="ConfirmarEnviar();">
                        <i class="glyphicon glyphicon-send "></i>
                        Enviar
                    </button>
                </h4>
            </div>
        </div>

        <div style="height:100%;">
            <div class="widget-box">
                <div class="widget-header" style="text-align:center;text-wrap:none;">
                    <h4 class="widget-title">
                    LISTA DE ÓRDENES</h4>
                    <div class="widget-toolbar">
                        <a href="#" data-action="collapse">
                            <i class="ace-icon fa fa-chevron-up"></i>
                        </a>

                    </div>
                    <font ng-hide="ContGrPedido==''" class="widget-toolbar"> Total: {{ContGrPedido}} Registros </font>
                </div>
                <div class="widget-body">
                    <div class="widget-main">
                        <div class="widget-body">
                            <div class="widget-main">
                                <div ng-controller="PaginationController">
                                    <div ng-show="showPaginate">
                                        <div class="span3">
                                            <div id="no-more-tables">
                                                <table class="table table-striped table-bordered table-condensed table-hover gridStyle">
                                                    <thead>
                                                        <tr>
                                                            <th class="grid-header uppercase info" >
                                                                <a href="#" ng-click="sortType = 'pCodProveedor'; sortReverse = !sortReverse">
                                                                    Código Proveedor
                                                                    <span ng-show="sortType == 'pCodProveedor' && !sortReverse" class="fa fa-caret-down"></span>
                                                                    <span ng-show="sortType == 'pCodProveedor' && sortReverse" class="fa fa-caret-up"></span>
                                                                </a>
                                                            </th>
                                                            <th class="grid-header uppercase info" >
                                                                <a href="#" ng-click="sortType = 'pNomProveedor'; sortReverse = !sortReverse">
                                                                    Razón Social
                                                                    <span ng-show="sortType == 'pNomProveedor' && !sortReverse" class="fa fa-caret-down"></span>
                                                                    <span ng-show="sortType == 'pNomProveedor' && sortReverse" class="fa fa-caret-up"></span>
                                                                </a>
                                                            </th>
                                                            <th class="grid-header uppercase info" >
                                                                <a href="#" ng-click="sortType = 'pNumPedido'; sortReverse = !sortReverse">
                                                                    Número de Orden
                                                                    <span ng-show="sortType == 'pNumPedido' && !sortReverse" class="fa fa-caret-down"></span>
                                                                    <span ng-show="sortType == 'pNumPedido' && sortReverse" class="fa fa-caret-up"></span>
                                                                </a>
                                                            </th>
                                                           
                                                            <th class="grid-header uppercase info" >
                                                                <a href="#" ng-click="sortType = 'pFechaPedido'; sortReverse = !sortReverse">
                                                                    Fecha Pedido
                                                                    <span ng-show="sortType == 'pFechaPedido' && !sortReverse" class="fa fa-caret-down"></span>
                                                                    <span ng-show="sortType == 'pFechaPedido' && sortReverse" class="fa fa-caret-up"></span>
                                                                </a>
                                                            </th>
                                                            <th class="grid-header uppercase info" style="text-align:center;font-size:11px;font:bold">
                                                                <a href="#" ng-click="sortType = 'fecEntregaActual'; sortReverse = !sortReverse">
                                                                    Fecha de Entrega
                                                                    <span ng-show="sortType == 'fecEntregaActual' && !sortReverse" class="fa fa-caret-down"></span>
                                                                    <span ng-show="sortType == 'fecEntregaActual' && sortReverse" class="fa fa-caret-up"></span>
                                                                </a>
                                                            </th>
                                                            <th class="grid-header uppercase info" >
                                                                <a href="#" ng-click="sortType = 'pCantPedido'; sortReverse = !sortReverse">
                                                                    Total Pedido
                                                                    <span ng-show="sortType == 'pCantPedido' && !sortReverse" class="fa fa-caret-down"></span>
                                                                    <span ng-show="sortType == 'pCantPedido' && sortReverse" class="fa fa-caret-up"></span>
                                                                </a>
                                                            </th>
                                                          
                                                            <th class="grid-header uppercase info">
                                                                <a href="#" ng-click="sortType = 'pCantPedido'; sortReverse = !sortReverse">
                                                                    Total Facturas
                                                                    <span ng-show="sortType == 'pCantPedido' && !sortReverse" class="fa fa-caret-down"></span>
                                                                    <span ng-show="sortType == 'pCantPedido' && sortReverse" class="fa fa-caret-up"></span>
                                                                </a>
                                                            </th>
                                                          
                                                          
                                                            <th class="grid-header uppercase info" >
                                                                <a href="#" ng-click="sortType = 'pPrecioCosto'; sortReverse = !sortReverse">
                                                                    Pendiente Pedido
                                                                    <span ng-show="sortType == 'pPrecioCosto' && !sortReverse" class="fa fa-caret-down"></span>
                                                                    <span ng-show="sortType == 'pPrecioCosto' && sortReverse" class="fa fa-caret-up"></span>
                                                                </a>
                                                            </th>
                                                            <th class="grid-header uppercase info" >
                                                                <a href="#" ng-click="sortType = 'pCodAlmacen'; sortReverse = !sortReverse">
                                                                    Cód. Almacén
                                                                    <span ng-show="sortType == 'pCodAlmacen' && !sortReverse" class="fa fa-caret-down"></span>
                                                                    <span ng-show="sortType == 'pCodAlmacen' && sortReverse" class="fa fa-caret-up"></span>
                                                                </a>
                                                            </th>
                                                            <th class="grid-header uppercase info">
                                                                <a href="#" ng-click="sortType = 'pNomAlmacen'; sortReverse = !sortReverse">
                                                                    Nombre Almacén
                                                                    <span ng-show="sortType == 'pNomAlmacen' && !sortReverse" class="fa fa-caret-down"></span>
                                                                    <span ng-show="sortType == 'pNomAlmacen' && sortReverse" class="fa fa-caret-up"></span>
                                                                </a>
                                                            </th>
                                                            <th class="grid-header uppercase info" >
                                                                <a href="#" ng-click="sortType = 'pCodAlmDestino'; sortReverse = !sortReverse">
                                                                    Almacén Destino
                                                                    <span ng-show="sortType == 'pCodAlmDestino' && !sortReverse" class="fa fa-caret-down"></span>
                                                                    <span ng-show="sortType == 'pCodAlmDestino' && sortReverse" class="fa fa-caret-up"></span>
                                                                </a>
                                                            </th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <tr ng-repeat="row in pageContentPed | filter:filterByEstados:strict | orderBy:sortType:sortReverse">
                                                            <td class="filacentro" data-title="CÓD. PROVEEDOR">{{row.pCodProveedor}}</td>
                                                            <td class="filaizquierda"  data-title="RAZÓN SOCIAL">{{row.pNomProveedor}}</td>
                                                            <td class="filacentro" data-title="NO. PEDIDO">{{row.pNumPedido}}</td>                                                       
                                                            <td class="filacentro" data-title="FECHA PEDIDO">{{row.pFechaPedido| date:'dd/MM/yyyy'}}</td>
                                                            <td class="filacentro" data-title="FECHA ENTREGA">{{row.fecEntregaActual | date:'dd/MM/yyyy'}}</td>
                                                            <td class="filaderecha" data-title="CANT. PEDIDO">{{row.pCantPedido| number:'2'}}</td>                                                           
                                                            <td class="filaderecha"  data-title="PRECIO COSTO">{{row.pPrecioCosto| number:'2'}}</td>
                                                            <td class="filaderecha" data-title="PRECIO COSTO">{{row.pDescuento1| number:'2'}}</td>
                                                            <td class="filacentro"  data-title="CÓD. ALMACÉN">{{row.pCodAlmacen}}</td>
                                                            <td class="filaizquierda" data-title="NOMBRE ALMACÉN">{{row.pNomAlmacen}}</td>
                                                            <td class="filaizquierda" data-title="ALMACÉN DESTINO">{{row.pCodAlmDestino}}</td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                        
                                       
                                    </div>
                                    <ul style="position: relative;" class="pagination" ng-hide="pagesPed.length==0">

                                        <li pagination ng-class="[{active: page == getCurrentPage()}, {disabled: isFirstPage()} ]  " page="1">
                                            <a><div class="glyphicon glyphicon-fast-backward"></div></a>
                                        </li>
                                        <li ng-class="{disabled: isFirstPage()}" pagination-left><a><div class="glyphicon glyphicon-backward"></div></a></li>
                                        <li>
                                            <a> {{getCurrentPage()}} </a> <a>de</a> <a> {{pagesPed.length}}</a>
                                        </li>
                                        <li ng-class="{disabled: isLastPage()}" pagination-right><a><div class="glyphicon glyphicon-forward"></div></a></li>
                                        <li pagination ng-class="[{active: page == getCurrentPage()}, {disabled: isLastPage()} ]  " page="{{pagesPed.length}}">
                                            <a><div class="glyphicon glyphicon-fast-forward"></div></a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        @*Session Modal Lista de Proveedores*@
        <div class="modal fade" data-backdrop="static" data-keyboard="false" id="usuariosEnvia" tabindex="-1" role="dialog" aria-hidden="true" style="z-index:98;height:100%; width:100%; ">

            <div class="modal-dialog" style="height:100%; width:60%;  top:20%; ">

                <div class="modal-content">

                    <div class="modal-body" style="max-height: 100%; overflow-y: auto;">




                        <div class=" widget-box">



                            <div class="widget-header" style="text-align:center">
                                <h4 class="widget-title">Listado de Usuarios</h4>
                                <div class="widget-toolbar">
                                    <a href="#" data-action="collapse">
                                        <i class="ace-icon fa fa-chevron-up"></i>
                                    </a>
                                </div>
                            </div>

                            <div class="widget-body">
                                <div class="widget-main">


                                    <div class="widget-body">


                                        <div ng-controller="PaginationController">
                                            <div style=" height: 250px !important;overflow: scroll;">
                                                <div id=" no-more-tables">
                                                    <table class="table table-striped table-bordered table-condensed table-hover gridStyle">
                                                        <thead>
                                                            <tr>

                                                                <th class="grid-header uppercase info" st-sort="representante">
                                                                    <a href="#" ng-click="sortType = 'representante'; sortReverse = !sortReverse">
                                                                        Nombres
                                                                        <span ng-show="sortType == 'representante' && !sortReverse" class="fa fa-caret-down"></span>
                                                                        <span ng-show="sortType == 'representante' && sortReverse" class="fa fa-caret-up"></span>
                                                                    </a>
                                                                </th>
                                                                <th class="grid-header uppercase info" st-sort="razonSocial">
                                                                    <a href="#" ng-click="sortType = 'razonSocial'; sortReverse = !sortReverse">
                                                                        Correo
                                                                        <span ng-show="sortType == 'razonSocial' && !sortReverse" class="fa fa-caret-down"></span>
                                                                        <span ng-show="sortType == 'razonSocial' && sortReverse" class="fa fa-caret-up"></span>
                                                                    </a>
                                                                </th>
                                                                <th class="grid-header uppercase info" st-sort="Seleccionar">


                                                                    <input type="checkbox" ng-model="allChecks" ng-click="marcaChecks(allChecks)" />

                                                                </th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <tr ng-repeat="content2 in resDgUsrsEnviar">

                                                                <td class="filaizquierda" data-title="Nombres">{{content2.nombres}}</td>
                                                                <td class="filaizquierda" data-title="Correo">{{content2.correoEnviar}}</td>
                                                                <td class="filacentro" data-title="SELECCIONAR">
                                                                    <input type="checkbox" ng-disabled="isLectura" ng-model="content2.isCheck" />



                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>


                                            </div>
                                        </div>

                                    </div>

                                </div>
                            </div>

                        </div>



                    </div>
                    <div class="modal-footer" style="text-align:right">
                        <button style="background-color:rgb(238,37,34)!important;border-color:rgb(238,37,34) !important" type="button" class="btn btn-sm btn-round" data-dismiss="modal" aria-hidden="true">
                            <i class="glyphicon glyphicon-floppy-remove"></i>
                            Cancelar
                        </button>
                        <button style="background-color:rgb(238,37,34)!important;border-color:rgb(238,37,34) !important" type="button" ng-click="CargaConsulta(2)" class="btn btn-sm btn-round" aria-hidden="true">
                            <i class="glyphicon glyphicon-check"></i>
                            Aceptar
                        </button>


                    </div>
                </div>
            </div>
        </div>
        @*Fin Session Modal Lista de Proveedores*@
        @Html.Partial("_mensajeConfirmado")
        @Html.Partial("_mensajeConfirmacion")
        @Html.Partial("_mensajeError")
        @Html.Partial("_mensajeInformativo")
        @Html.Partial("_mensajeOK")

    </div>

</body>

@section scripts{
    <script src="~/assets/js/fileinput.js"></script>
    <script src="~/assets/js/fileinput.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {

            $("#file-3").fileinput({
                showCaption: false,
                browseClass: "btn btn-sm btn-round",
                fileType: "any"
            });
        });
        //webshims.setOptions('waitReady', false);
        ////webshims.setOptions('forms-ext', { types: 'date' });
        //webshims.polyfill('forms forms-ext');
        //$.webshims.formcfg = {
        //    en: {
        //        dFormat: '/',
        //        dateSigns: '/',
        //        patterns: {
        //            d: "dd/mm/yy"
        //        }
        //    }
        //};

        //$.webshims.activeLang('en');
        $('.date-picker').datepicker({
            minDate: new Date(1999, 10 - 1, 25),
            maxDate: '+30Y',
            autoclose: true,
            todayHighlight: true
        })
       //show datepicker when clicking on the icon
       .next().on(ace.click_event, function () {
           $(this).prev().focus();
       });
        $('.input-mask-date').mask('99/99/9999');
        
    </script>
}